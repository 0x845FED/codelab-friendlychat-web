/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw Error();const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},r=function(e){return function(e){const r=t(e);return n.encodeByteArray(r,!0)}(e).replace(/\./g,"")},i=function(e){try{return n.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function s(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}const o=()=>{try{return s().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&i(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},a=e=>{var t,n;return null===(n=null===(t=o())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},c=e=>{const t=a(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},u=()=>{var e;return null===(e=o())||void 0===e?void 0:e.config},l=e=>{var t;return null===(t=o())||void 0===t?void 0:t[`_${e}`]};class h{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function d(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function p(){try{return"object"==typeof indexedDB}catch(e){return!1}}function g(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}function m(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class y extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,v.prototype.create)}}class v{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(w,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new y(r,o,n)}}const w=/\{\$([^}]+)}/g;function _(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(b(n)&&b(s)){if(!_(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function b(e){return null!==e&&"object"==typeof e}function T(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function E(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function I(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class k{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=S),void 0===r.error&&(r.error=S),void 0===r.complete&&(r.complete=S);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function S(){}const C=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},A=1e3,R=2,N=144e5,D=.5;function O(e){return e&&e._delegate?e._delegate:e}class P{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const L="[DEFAULT]";class M{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new h;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:L})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=L){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=L){return this.instances.has(e)}getOptions(e=L){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===L?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=L){return this.component?this.component.multipleInstances?e:L:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class x{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new M(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const U=[];var F,V;(V=F||(F={}))[V.DEBUG=0]="DEBUG",V[V.VERBOSE=1]="VERBOSE",V[V.INFO=2]="INFO",V[V.WARN=3]="WARN",V[V.ERROR=4]="ERROR",V[V.SILENT=5]="SILENT";const B={debug:F.DEBUG,verbose:F.VERBOSE,info:F.INFO,warn:F.WARN,error:F.ERROR,silent:F.SILENT},j=F.INFO,q={[F.DEBUG]:"log",[F.VERBOSE]:"log",[F.INFO]:"info",[F.WARN]:"warn",[F.ERROR]:"error"},$=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=q[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class K{constructor(e){this.name=e,this._logLevel=j,this._logHandler=$,this._userLogHandler=null,U.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in F))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?B[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,F.DEBUG,...e),this._logHandler(this,F.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,F.VERBOSE,...e),this._logHandler(this,F.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,F.INFO,...e),this._logHandler(this,F.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,F.WARN,...e),this._logHandler(this,F.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,F.ERROR,...e),this._logHandler(this,F.ERROR,...e)}}const H=(e,t)=>t.some((t=>e instanceof t));let z,G;const W=new WeakMap,Q=new WeakMap,X=new WeakMap,J=new WeakMap,Y=new WeakMap;let Z={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Q.get(e);if("objectStoreNames"===t)return e.objectStoreNames||X.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return te(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ee(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(G||(G=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(ne(this),e),te(W.get(this))}:function(...e){return te(t.apply(ne(this),e))}:function(e,...n){const r=t.call(ne(this),e,...n);return X.set(r,e.sort?e.sort():[e]),te(r)}:(e instanceof IDBTransaction&&function(e){if(Q.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));Q.set(e,t)}(e),H(e,z||(z=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Z):e);var t}function te(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(te(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&W.set(t,e)})).catch((()=>{})),Y.set(t,e),t}(e);if(J.has(e))return J.get(e);const t=ee(e);return t!==e&&(J.set(e,t),Y.set(t,e)),t}const ne=e=>Y.get(e);function re(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=te(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(te(o.result),e.oldVersion,e.newVersion,te(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}function ie(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(()=>t())),te(n).then((()=>{}))}const se=["get","getKey","getAll","getAllKeys","count"],oe=["put","add","delete","clear"],ae=new Map;function ce(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ae.get(t))return ae.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=oe.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!se.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return ae.set(t,s),s}var ue;ue=Z,Z={...ue,get:(e,t,n)=>ce(e,t)||ue.get(e,t,n),has:(e,t)=>!!ce(e,t)||ue.has(e,t)};class le{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const he="@firebase/app",de="0.9.3",fe=new K("@firebase/app"),pe="[DEFAULT]",ge={[he]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},me=new Map,ye=new Map;function ve(e,t){try{e.container.addComponent(t)}catch(n){fe.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function we(e){const t=e.name;if(ye.has(t))return fe.debug(`There were multiple attempts to register component ${t}.`),!1;ye.set(t,e);for(const t of me.values())ve(t,e);return!0}function _e(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const be=new v("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Te{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new P("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw be.create("app-deleted",{appName:this._name})}}const Ee="9.17.1";function Ie(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:pe,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw be.create("bad-app-name",{appName:String(i)});if(n||(n=u()),!n)throw be.create("no-options");const s=me.get(i);if(s){if(_(n,s.options)&&_(r,s.config))return s;throw be.create("duplicate-app",{appName:i})}const o=new x(i);for(const e of ye.values())o.addComponent(e);const a=new Te(n,r,o);return me.set(i,a),a}function ke(e=pe){const t=me.get(e);if(!t&&e===pe)return Ie();if(!t)throw be.create("no-app",{appName:e});return t}function Se(e,t,n){var r;let i=null!==(r=ge[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void fe.warn(e.join(" "))}we(new P(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const Ce="firebase-heartbeat-database",Ae=1,Re="firebase-heartbeat-store";let Ne=null;function De(){return Ne||(Ne=re(Ce,Ae,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Re)}}).catch((e=>{throw be.create("idb-open",{originalErrorMessage:e.message})}))),Ne}async function Oe(e,t){try{const n=(await De()).transaction(Re,"readwrite"),r=n.objectStore(Re);return await r.put(t,Pe(e)),n.done}catch(e){if(e instanceof y)fe.warn(e.message);else{const t=be.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});fe.warn(t.message)}}}function Pe(e){return`${e.name}!${e.options.appId}`}class Le{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new xe(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Me();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Me(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Ue(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Ue(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=r(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Me(){return(new Date).toISOString().substring(0,10)}class xe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!p()&&g().then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{return(await De()).transaction(Re).objectStore(Re).get(Pe(e))}catch(e){if(e instanceof y)fe.warn(e.message);else{const t=be.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});fe.warn(t.message)}}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Ue(e){return r(JSON.stringify({version:2,heartbeats:e})).length}function Fe(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}we(new P("platform-logger",(e=>new le(e)),"PRIVATE")),we(new P("heartbeat",(e=>new Le(e)),"PRIVATE")),Se(he,de,""),Se(he,de,"esm2017"),Se("fire-js",""),Se("firebase","9.17.1","app"),Object.create,Object.create;const Ve=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Be=new v("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),je=new K("@firebase/auth");function qe(e,...t){je.logLevel<=F.ERROR&&je.error(`Auth (${Ee}): ${e}`,...t)}function $e(e,...t){throw ze(e,...t)}function Ke(e,...t){return ze(e,...t)}function He(e,t,n){const r=Object.assign(Object.assign({},Ve()),{[t]:n});return new v("auth","Firebase",r).create(t,{appName:e.name})}function ze(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Be.create(e,...t)}function Ge(e,t,...n){if(!e)throw ze(t,...n)}function We(e){const t="INTERNAL ASSERTION FAILED: "+e;throw qe(t),new Error(t)}function Qe(e,t){e||We(t)}const Xe=new Map;function Je(e){Qe(e instanceof Function,"Expected a class definition");let t=Xe.get(e);return t?(Qe(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Xe.set(e,t),t)}function Ye(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Ze(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function et(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Ze()||"https:"===Ze()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class tt{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qe(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return et()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function nt(e,t){Qe(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class rt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void We("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void We("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void We("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const it={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},st=new tt(3e4,6e4);function ot(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function at(e,t,n,r,i={}){return ct(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=T(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),rt.fetch()(lt(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function ct(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},it),t);try{const t=new ht(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw dt(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw dt(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw dt(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw dt(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw He(e,a,o);$e(e,a)}}catch(t){if(t instanceof y)throw t;$e(e,"network-request-failed")}}async function ut(e,t,n,r,i={}){const s=await at(e,t,n,r,i);return"mfaPendingCredential"in s&&$e(e,"multi-factor-auth-required",{_serverResponse:s}),s}function lt(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?nt(e.config,i):`${e.config.apiScheme}://${i}`}class ht{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Ke(this.auth,"network-request-failed"))),st.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function dt(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Ke(e,t,r);return i.customData._tokenResponse=n,i}function ft(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function pt(e){return 1e3*Number(e)}function gt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return qe("JWT malformed, contained fewer than 3 sections"),null;try{const e=i(n);return e?JSON.parse(e):(qe("Failed to decode base64 JWT payload"),null)}catch(e){return qe("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function mt(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof y&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class yt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class vt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ft(this.lastLoginAt),this.creationTime=ft(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function wt(e){var t;const n=e.auth,r=await e.getIdToken(),i=await mt(e,async function(e,t){return at(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));Ge(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Fe(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new vt(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class _t{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ge(e.idToken,"internal-error"),Ge(void 0!==e.idToken,"internal-error"),Ge(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=gt(e);return Ge(t,"internal-error"),Ge(void 0!==t.exp,"internal-error"),Ge(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Ge(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await ct(e,{},(async()=>{const n=T({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=lt(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",rt.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new _t;return n&&(Ge("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Ge("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Ge("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new _t,this.toJSON())}_performRefresh(){return We("not implemented")}}function bt(e,t){Ge("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Tt{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Fe(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new vt(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await mt(this,this.stsTokenManager.getToken(this.auth,e));return Ge(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=O(e),r=await n.getIdToken(t),i=gt(r);Ge(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:ft(pt(i.auth_time)),issuedAtTime:ft(pt(i.iat)),expirationTime:ft(pt(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=O(e);await wt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Ge(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Tt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){Ge(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await wt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await mt(this,async function(e,t){return at(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:b,stsTokenManager:T}=t;Ge(v&&T,e,"internal-error");const E=_t.fromJSON(this.name,T);Ge("string"==typeof v,e,"internal-error"),bt(l,e.name),bt(h,e.name),Ge("boolean"==typeof w,e,"internal-error"),Ge("boolean"==typeof _,e,"internal-error"),bt(d,e.name),bt(f,e.name),bt(p,e.name),bt(g,e.name),bt(m,e.name),bt(y,e.name);const I=new Tt({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return b&&Array.isArray(b)&&(I.providerData=b.map((e=>Object.assign({},e)))),g&&(I._redirectEventId=g),I}static async _fromIdTokenResponse(e,t,n=!1){const r=new _t;r.updateFromServerResponse(t);const i=new Tt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await wt(i),i}}class Et{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Et.type="NONE";const It=Et;function kt(e,t,n){return`firebase:${e}:${t}:${n}`}class St{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=kt(this.userKey,r.apiKey,i),this.fullPersistenceKey=kt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Tt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new St(Je(It),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||Je(It);const s=kt(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=Tt._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new St(i,e,n)):new St(i,e,n)}}function Ct(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Dt(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(At(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Pt(t))return"Blackberry";if(Lt(t))return"Webos";if(Rt(t))return"Safari";if((t.includes("chrome/")||Nt(t))&&!t.includes("edge/"))return"Chrome";if(Ot(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function At(e=f()){return/firefox\//i.test(e)}function Rt(e=f()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Nt(e=f()){return/crios\//i.test(e)}function Dt(e=f()){return/iemobile/i.test(e)}function Ot(e=f()){return/android/i.test(e)}function Pt(e=f()){return/blackberry/i.test(e)}function Lt(e=f()){return/webos/i.test(e)}function Mt(e=f()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function xt(e=f()){return Mt(e)||Ot(e)||Lt(e)||Pt(e)||/windows phone/i.test(e)||Dt(e)}function Ut(e,t=[]){let n;switch(e){case"Browser":n=Ct(f());break;case"Worker":n=`${Ct(f())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ee}/${r}`}class Ft{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Vt{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new jt(this),this.idTokenSubscription=new jt(this),this.beforeStateQueue=new Ft(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Be,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Je(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await St.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ge(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await wt(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?O(e):null;return t&&Ge(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ge(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Je(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new v("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Je(e)||this._popupRedirectResolver;Ge(t,this,"argument-error"),this.redirectPersistenceManager=await St.create(this,[Je(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return Ge(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ge(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ut(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function Bt(e){return O(e)}class jt{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new k(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Ge(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function qt(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function $t(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Kt{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return We("not implemented")}_getIdTokenResponse(e){return We("not implemented")}_linkToIdToken(e,t){return We("not implemented")}_getReauthenticationResolver(e){return We("not implemented")}}class Ht extends Kt{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Ht(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Ht(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return ut(e,"POST","/v1/accounts:signInWithPassword",ot(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return ut(e,"POST","/v1/accounts:signInWithEmailLink",ot(e,t))}(e,{email:this._email,oobCode:this._password});default:$e(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return at(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return ut(e,"POST","/v1/accounts:signInWithEmailLink",ot(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:$e(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function zt(e,t){return ut(e,"POST","/v1/accounts:signInWithIdp",ot(e,t))}class Gt extends Kt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Gt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):$e("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Fe(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Gt(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return zt(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,zt(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,zt(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=T(t)}return e}}const Wt={USER_NOT_FOUND:"user-not-found"};class Qt extends Kt{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Qt({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Qt({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return ut(e,"POST","/v1/accounts:signInWithPhoneNumber",ot(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await ut(e,"POST","/v1/accounts:signInWithPhoneNumber",ot(e,t));if(n.temporaryProof)throw dt(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return ut(e,"POST","/v1/accounts:signInWithPhoneNumber",ot(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Wt)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Qt({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Xt{constructor(e){var t,n,r,i,s,o;const a=E(I(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Ge(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=E(I(e)).link,n=t?E(I(t)).deep_link_id:null,r=E(I(e)).deep_link_id;return(r?E(I(r)).link:null)||r||n||t||e}(e);try{return new Xt(t)}catch(e){return null}}}class Jt{constructor(){this.providerId=Jt.PROVIDER_ID}static credential(e,t){return Ht._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Xt.parseLink(t);return Ge(n,"argument-error"),Ht._fromEmailAndCode(e,n.code,n.tenantId)}}Jt.PROVIDER_ID="password",Jt.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Jt.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Yt{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Zt extends Yt{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class en extends Zt{constructor(){super("facebook.com")}static credential(e){return Gt._fromParams({providerId:en.PROVIDER_ID,signInMethod:en.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return en.credentialFromTaggedObject(e)}static credentialFromError(e){return en.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return en.credential(e.oauthAccessToken)}catch(e){return null}}}en.FACEBOOK_SIGN_IN_METHOD="facebook.com",en.PROVIDER_ID="facebook.com";class tn extends Zt{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Gt._fromParams({providerId:tn.PROVIDER_ID,signInMethod:tn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return tn.credentialFromTaggedObject(e)}static credentialFromError(e){return tn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return tn.credential(t,n)}catch(e){return null}}}tn.GOOGLE_SIGN_IN_METHOD="google.com",tn.PROVIDER_ID="google.com";class nn extends Zt{constructor(){super("github.com")}static credential(e){return Gt._fromParams({providerId:nn.PROVIDER_ID,signInMethod:nn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nn.credentialFromTaggedObject(e)}static credentialFromError(e){return nn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return nn.credential(e.oauthAccessToken)}catch(e){return null}}}nn.GITHUB_SIGN_IN_METHOD="github.com",nn.PROVIDER_ID="github.com";class rn extends Zt{constructor(){super("twitter.com")}static credential(e,t){return Gt._fromParams({providerId:rn.PROVIDER_ID,signInMethod:rn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rn.credentialFromTaggedObject(e)}static credentialFromError(e){return rn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return rn.credential(t,n)}catch(e){return null}}}rn.TWITTER_SIGN_IN_METHOD="twitter.com",rn.PROVIDER_ID="twitter.com";class sn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Tt._fromIdTokenResponse(e,n,r),s=on(n);return new sn({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=on(n);return new sn({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function on(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class an extends y{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,an.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new an(e,t,n,r)}}function cn(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw an._fromErrorAndOperation(e,n,t,r);throw n}))}new WeakMap;const un="__sak";class ln{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(un,"1"),this.storage.removeItem(un),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class hn extends ln{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=f();return Rt(e)||Mt(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=xt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=f();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}hn.type="LOCAL";const dn=hn;class fn extends ln{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}fn.type="SESSION";const pn=fn;class gn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new gn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function mn(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}gn.receivers=[];class yn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=mn("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function vn(){return window}function wn(){return void 0!==vn().WorkerGlobalScope&&"function"==typeof vn().importScripts}const _n="firebaseLocalStorageDb",bn=1,Tn="firebaseLocalStorage",En="fbase_key";class In{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function kn(e,t){return e.transaction([Tn],t?"readwrite":"readonly").objectStore(Tn)}function Sn(){const e=indexedDB.open(_n,bn);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Tn,{keyPath:En})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Tn)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(_n);return new In(e).toPromise()}(),t(await Sn()))}))}))}async function Cn(e,t,n){const r=kn(e,!0).put({[En]:t,value:n});return new In(r).toPromise()}function An(e,t){const n=kn(e,!0).delete(t);return new In(n).toPromise()}class Rn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Sn()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return wn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gn._getInstance(wn()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new yn(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Sn();return await Cn(e,un,"1"),await An(e,un),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Cn(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=kn(e,!1).get(t),r=await new In(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>An(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=kn(e,!1).getAll();return new In(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Rn.type="LOCAL";const Nn=Rn;function Dn(e){return`__${e}${Math.floor(1e6*Math.random())}`}Dn("rcb"),new tt(3e4,6e4);const On="recaptcha";class Pn{constructor(e){this.providerId=Pn.PROVIDER_ID,this.auth=Bt(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let s;if(Ge("string"==typeof i,e,"argument-error"),Ge(n.type===On,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){Ge("enroll"===t.type,e,"internal-error");const n=await function(e,t){return at(e,"POST","/v2/accounts/mfaEnrollment:start",ot(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{Ge("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;Ge(n,e,"missing-multi-factor-info");const o=await function(e,t){return at(e,"POST","/v2/accounts/mfaSignIn:start",ot(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return at(e,"POST","/v1/accounts:sendVerificationCode",ot(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,O(t))}static credential(e,t){return Qt._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Pn.credentialFromTaggedObject(t)}static credentialFromError(e){return Pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Qt._fromTokenResponse(t,n):null}}function Ln(e,t){return t?Je(t):(Ge(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Pn.PROVIDER_ID="phone",Pn.PHONE_SIGN_IN_METHOD="phone";class Mn extends Kt{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return zt(e,this._buildIdpRequest())}_linkToIdToken(e,t){return zt(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return zt(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function xn(e){return async function(e,t,n=!1){const r="signIn",i=await cn(e,r,t),s=await sn._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}(e.auth,new Mn(e),e.bypassAuthState)}function Un(e){const{auth:t,user:n}=e;return Ge(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await mt(e,cn(r,i,t,e),n);Ge(s.idToken,r,"internal-error");const o=gt(s.idToken);Ge(o,r,"internal-error");const{sub:a}=o;return Ge(e.uid===a,r,"user-mismatch"),sn._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&$e(r,"user-mismatch"),e}}(n,new Mn(e),e.bypassAuthState)}async function Fn(e){const{auth:t,user:n}=e;return Ge(n,t,"internal-error"),async function(e,t,n=!1){const r=await mt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return sn._forOperation(e,"link",r)}(n,new Mn(e),e.bypassAuthState)}class Vn{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return xn;case"linkViaPopup":case"linkViaRedirect":return Fn;case"reauthViaPopup":case"reauthViaRedirect":return Un;default:$e(this.auth,"internal-error")}}resolve(e){Qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Bn=new tt(2e3,1e4);class jn extends Vn{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,jn.currentPopupAction&&jn.currentPopupAction.cancel(),jn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ge(e,this.auth,"internal-error"),e}async onExecution(){Qe(1===this.filter.length,"Popup operations only handle one event");const e=mn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Ke(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Ke(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,jn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Ke(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,Bn.get())};e()}}jn.currentPopupAction=null;const qn="pendingRedirect",$n=new Map;class Kn extends Vn{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=$n.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return kt(qn,e.config.apiKey,e.name)}(t),r=function(e){return Je(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}$n.set(this.auth._key(),e)}return this.bypassAuthState||$n.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Hn(e,t){$n.set(e._key(),t)}async function zn(e,t,n=!1){const r=Bt(e),i=Ln(r,t),s=new Kn(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class Gn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Qn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Qn(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ke(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Wn(e))}saveEventToCache(e){this.cachedEventUids.add(Wn(e)),this.lastProcessedEventTime=Date.now()}}function Wn(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Qn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Xn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Jn=/^https?/;function Yn(e){const t=Ye(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Jn.test(n))return!1;if(Xn.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Zn=new tt(3e4,6e4);function er(){const e=vn().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let tr=null;function nr(e){return tr=tr||function(e){return new Promise(((t,n)=>{var r,i,s,o;function a(){er(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{er(),n(Ke(e,"network-request-failed"))},timeout:Zn.get()})}if(null===(i=null===(r=vn().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=vn().gapi)||void 0===s?void 0:s.load)){const t=Dn("iframefcb");return vn()[t]=()=>{gapi.load?a():n(Ke(e,"network-request-failed"))},(o=`https://apis.google.com/js/api.js?onload=${t}`,new Promise(((e,t)=>{const n=document.createElement("script");n.setAttribute("src",o),n.onload=e,n.onerror=e=>{const n=Ke("internal-error");n.customData=e,t(n)},n.type="text/javascript",n.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(n)}))).catch((e=>n(e)))}a()}})).catch((e=>{throw tr=null,e}))}(e),tr}const rr=new tt(5e3,15e3),ir="__/auth/iframe",sr="emulator/auth/iframe",or={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ar=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cr(e){const t=e.config;Ge(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?nt(t,sr):`https://${e.config.authDomain}/${ir}`,r={apiKey:t.apiKey,appName:e.name,v:Ee},i=ar.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${T(r).slice(1)}`}const ur={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},lr=500,hr=600,dr="_blank",fr="http://localhost";class pr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const gr="__/auth/handler",mr="emulator/auth/handler";function yr(e,t,n,r,i,s){Ge(e.config.authDomain,e,"auth-domain-config-required"),Ge(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Ee,eventId:i};if(t instanceof Yt){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof Zt){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];return`${function({config:e}){return e.emulator?nt(e,mr):`https://${e.authDomain}/${gr}`}(e)}?${T(a).slice(1)}`}const vr="webStorageSupport",wr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=pn,this._completeRedirectFn=zn,this._overrideRedirectResult=Hn}async _openPopup(e,t,n,r){var i;return Qe(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=lr,i=hr){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},ur),{width:r.toString(),height:i.toString(),top:s,left:o}),u=f().toLowerCase();n&&(a=Nt(u)?dr:n),At(u)&&(t=t||fr,c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=f()){var t;return Mt(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new pr(null);const h=window.open(t||"",a,l);Ge(h,e,"popup-blocked");try{h.focus()}catch(e){}return new pr(h)}(e,yr(e,t,n,Ye(),r),mn())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=yr(e,t,n,Ye(),r),vn().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Qe(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await nr(e),n=vn().gapi;return Ge(n,e,"internal-error"),t.open({where:document.body,url:cr(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:or,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Ke(e,"network-request-failed"),s=vn().setTimeout((()=>{r(i)}),rr.get());function o(){vn().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Gn(e);return t.register("authEvent",(t=>(Ge(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(vr,{type:vr},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[vr];void 0!==i&&t(!!i),$e(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return at(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Yn(e))return}catch(e){}$e(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return xt()||Rt()||Mt()}};var _r="@firebase/auth",br="0.21.3";class Tr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ge(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Er=l("authIdTokenMaxAge")||300;let Ir=null;const kr=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Er)return;const i=null==n?void 0:n.token;Ir!==i&&(Ir=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Sr(e=ke()){const t=_e(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=_e(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(_(n.getOptions(),null!=t?t:{}))return e;$e(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:wr,persistence:[Nn,dn,pn]}),r=l("authTokenSyncURL");if(r){const e=kr(r);!function(e,t,n){O(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t,n,r,i){O(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}const i=a("auth");return i&&function(e,t,n){const r=Bt(e);Ge(r._canInitEmulator,r,"emulator-config-failed"),Ge(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=qt(t),{host:o,port:a}=function(e){const t=qt(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:$t(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:$t(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${i}`),n}var Cr;Cr="Browser",we(new P("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:i,authDomain:s}=n.options;return((e,n)=>{Ge(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),Ge(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const r={apiKey:i,authDomain:s,clientPlatform:Cr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ut(Cr)},o=new Vt(e,n,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Je);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,r)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),we(new P("auth-internal",(e=>(e=>new Tr(e))(Bt(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Se(_r,br,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Cr)),Se(_r,br,"esm2017");var Ar,Rr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e.g?e.g:"undefined"!=typeof self?self:{},Nr={},Dr=Dr||{},Or=Rr||self;function Pr(){}function Lr(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Mr(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var xr="closure_uid_"+(1e9*Math.random()>>>0),Ur=0;function Fr(e,t,n){return e.call.apply(e.bind,arguments)}function Vr(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Br(e,t,n){return(Br=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Fr:Vr).apply(null,arguments)}function jr(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function qr(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function $r(){this.s=this.s,this.o=this.o}$r.prototype.s=!1,$r.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,xr)&&e[xr]||(e[xr]=++Ur))},$r.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Kr=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Hr(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function zr(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Lr(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function Gr(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Gr.prototype.h=function(){this.defaultPrevented=!0};var Wr=function(){if(!Or.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Or.addEventListener("test",Pr,t),Or.removeEventListener("test",Pr,t)}catch(e){}return e}();function Qr(e){return/^[\s\xa0]*$/.test(e)}var Xr=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Jr(e,t){return e<t?-1:e>t?1:0}function Yr(){var e=Or.navigator;return e&&(e=e.userAgent)?e:""}function Zr(e){return-1!=Yr().indexOf(e)}function ei(e){return ei[" "](e),e}ei[" "]=Pr;var ti,ni,ri=Zr("Opera"),ii=Zr("Trident")||Zr("MSIE"),si=Zr("Edge"),oi=si||ii,ai=Zr("Gecko")&&!(-1!=Yr().toLowerCase().indexOf("webkit")&&!Zr("Edge"))&&!(Zr("Trident")||Zr("MSIE"))&&!Zr("Edge"),ci=-1!=Yr().toLowerCase().indexOf("webkit")&&!Zr("Edge");function ui(){var e=Or.document;return e?e.documentMode:void 0}e:{var li="",hi=(ni=Yr(),ai?/rv:([^\);]+)(\)|;)/.exec(ni):si?/Edge\/([\d\.]+)/.exec(ni):ii?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ni):ci?/WebKit\/(\S+)/.exec(ni):ri?/(?:Version)[ \/]?(\S+)/.exec(ni):void 0);if(hi&&(li=hi?hi[1]:""),ii){var di=ui();if(null!=di&&di>parseFloat(li)){ti=String(di);break e}}ti=li}var fi,pi={};function gi(){return function(e){var t=pi;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let e=0;const t=Xr(String(ti)).split("."),n=Xr("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=Jr(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Jr(0==i[2].length,0==s[2].length)||Jr(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}()}()}Or.document&&ii?fi=ui()||parseInt(ti,10)||void 0:fi=void 0;var mi=fi;function yi(e,t){if(Gr.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ai){e:{try{ei(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:vi[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&yi.X.h.call(this)}}qr(yi,Gr);var vi={2:"touch",3:"pen",4:"mouse"};yi.prototype.h=function(){yi.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var wi="closure_listenable_"+(1e6*Math.random()|0),_i=0;function bi(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++_i,this.ba=this.ea=!1}function Ti(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Ei(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Ii(e){const t={};for(const n in e)t[n]=e[n];return t}const ki="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Si(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<ki.length;t++)n=ki[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Ci(e){this.src=e,this.g={},this.h=0}function Ai(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Kr(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Ti(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Ri(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}Ci.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Ri(e,t,r,i);return-1<o?(t=e[o],n||(t.ea=!1)):((t=new bi(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var Ni="closure_lm_"+(1e6*Math.random()|0),Di={};function Oi(e,t,n,r,i){if(r&&r.once)return Li(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Oi(e,t[s],n,r,i);return null}return n=ji(n),e&&e[wi]?e.N(t,n,Mr(r)?!!r.capture:!!r,i):Pi(e,t,n,!1,r,i)}function Pi(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=Mr(i)?!!i.capture:!!i,a=Vi(e);if(a||(e[Ni]=a=new Ci(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=Fi;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Wr||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Ui(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Li(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Li(e,t[s],n,r,i);return null}return n=ji(n),e&&e[wi]?e.O(t,n,Mr(r)?!!r.capture:!!r,i):Pi(e,t,n,!0,r,i)}function Mi(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Mi(e,t[s],n,r,i);else r=Mr(r)?!!r.capture:!!r,n=ji(n),e&&e[wi]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Ri(s=e.g[t],n,r,i))&&(Ti(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Vi(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Ri(t,n,r,i)),(n=-1<e?t[e]:null)&&xi(n))}function xi(e){if("number"!=typeof e&&e&&!e.ba){var t=e.src;if(t&&t[wi])Ai(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Ui(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Vi(t))?(Ai(n,e),0==n.h&&(n.src=null,t[Ni]=null)):Ti(e)}}}function Ui(e){return e in Di?Di[e]:Di[e]="on"+e}function Fi(e,t){if(e.ba)e=!0;else{t=new yi(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&xi(e),e=n.call(r,t)}return e}function Vi(e){return(e=e[Ni])instanceof Ci?e:null}var Bi="__closure_events_fn_"+(1e9*Math.random()>>>0);function ji(e){return"function"==typeof e?e:(e[Bi]||(e[Bi]=function(t){return e.handleEvent(t)}),e[Bi])}function qi(){$r.call(this),this.i=new Ci(this),this.P=this,this.I=null}function $i(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new Gr(t,e);else if(t instanceof Gr)t.target=t.target||e;else{var i=t;Si(t=new Gr(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Ki(o,r,!0,t)&&i}if(i=Ki(o=t.g=e,r,!0,t)&&i,i=Ki(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Ki(o=t.g=n[s],r,!1,t)&&i}function Ki(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ba&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.ea&&Ai(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}qr(qi,$r),qi.prototype[wi]=!0,qi.prototype.removeEventListener=function(e,t,n,r){Mi(this,e,t,n,r)},qi.prototype.M=function(){if(qi.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Ti(n[r]);delete t.g[e],t.h--}}this.I=null},qi.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},qi.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Hi=Or.JSON.stringify;function zi(){var e=Zi;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Gi,Wi=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Qi),(e=>e.reset()));class Qi{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Xi(e){Or.setTimeout((()=>{throw e}),0)}function Ji(e,t){Gi||function(){var e=Or.Promise.resolve(void 0);Gi=function(){e.then(es)}}(),Yi||(Gi(),Yi=!0),Zi.add(e,t)}var Yi=!1,Zi=new class{constructor(){this.h=this.g=null}add(e,t){const n=Wi.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function es(){for(var e;e=zi();){try{e.h.call(e.g)}catch(e){Xi(e)}var t=Wi;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Yi=!1}function ts(e,t){qi.call(this),this.h=e||1,this.g=t||Or,this.j=Br(this.lb,this),this.l=Date.now()}function ns(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function rs(e,t,n){if("function"==typeof e)n&&(e=Br(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Br(e.handleEvent,e)}return 2147483647<Number(t)?-1:Or.setTimeout(e,t||0)}function is(e){e.g=rs((()=>{e.g=null,e.i&&(e.i=!1,is(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}qr(ts,qi),(Ar=ts.prototype).ca=!1,Ar.R=null,Ar.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),$i(this,"tick"),this.ca&&(ns(this),this.start()))}},Ar.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Ar.M=function(){ts.X.M.call(this),ns(this),delete this.g};class ss extends $r{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:is(this)}M(){super.M(),this.g&&(Or.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function os(e){$r.call(this),this.h=e,this.g={}}qr(os,$r);var as=[];function cs(e,t,n,r){Array.isArray(n)||(n&&(as[0]=n.toString()),n=as);for(var i=0;i<n.length;i++){var s=Oi(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function us(e){Ei(e.g,(function(e,t){this.g.hasOwnProperty(t)&&xi(e)}),e),e.g={}}function ls(){this.g=!0}function hs(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Hi(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}os.prototype.M=function(){os.X.M.call(this),us(this)},os.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ls.prototype.Aa=function(){this.g=!1},ls.prototype.info=function(){};var ds={},fs=null;function ps(){return fs=fs||new qi}function gs(e){Gr.call(this,ds.Pa,e)}function ms(e){const t=ps();$i(t,new gs(t))}function ys(e,t){Gr.call(this,ds.STAT_EVENT,e),this.stat=t}function vs(e){const t=ps();$i(t,new ys(t,e))}function ws(e,t){Gr.call(this,ds.Qa,e),this.size=t}function _s(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Or.setTimeout((function(){e()}),t)}ds.Pa="serverreachability",qr(gs,Gr),ds.STAT_EVENT="statevent",qr(ys,Gr),ds.Qa="timingevent",qr(ws,Gr);var bs={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Ts={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Es(){}function Is(e){return e.h||(e.h=e.i())}function ks(){}Es.prototype.h=null;var Ss,Cs={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function As(){Gr.call(this,"d")}function Rs(){Gr.call(this,"c")}function Ns(){}function Ds(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new os(this),this.O=Ps,e=oi?125:void 0,this.T=new ts(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Os}function Os(){this.i=null,this.g="",this.h=!1}qr(As,Gr),qr(Rs,Gr),qr(Ns,Es),Ns.prototype.g=function(){return new XMLHttpRequest},Ns.prototype.i=function(){return{}},Ss=new Ns;var Ps=45e3,Ls={},Ms={};function xs(e,t,n){e.K=1,e.v=to(Xs(t)),e.s=n,e.P=!0,Us(e,null)}function Us(e,t){e.F=Date.now(),js(e),e.A=Xs(e.v);var n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),go(n.i,"t",r),e.C=0,n=e.l.H,e.h=new Os,e.g=pa(e.l,n?t:null,!e.s),0<e.N&&(e.L=new ss(Br(e.La,e,e.g),e.N)),cs(e.S,e.g,"readystatechange",e.ib),t=e.H?Ii(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),ms(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.U,e.s)}function Fs(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function Vs(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Bs(e,n),r==Ms){4==t&&(e.o=4,vs(14),i=!1),hs(e.j,e.m,null,"[Incomplete Response]");break}if(r==Ls){e.o=4,vs(15),hs(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}hs(e.j,e.m,r,null),zs(e,r)}Fs(e)&&r!=Ms&&r!=Ls&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,vs(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),oa(t),t.K=!0,vs(11))):(hs(e.j,e.m,n,"[Invalid Chunked Response]"),Hs(e),Ks(e))}function Bs(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ms:(n=Number(t.substring(n,r)),isNaN(n)?Ls:(r+=1)+n>t.length?Ms:(t=t.substr(r,n),e.C=r+n,t))}function js(e){e.V=Date.now()+e.O,qs(e,e.O)}function qs(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=_s(Br(e.gb,e),t)}function $s(e){e.B&&(Or.clearTimeout(e.B),e.B=null)}function Ks(e){0==e.l.G||e.I||ua(e.l,e)}function Hs(e){$s(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,ns(e.T),us(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function zs(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||bo(n.h,e)))if(!e.J&&bo(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;ca(n),Yo(n)}sa(n),vs(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=_s(Br(n.cb,n),6e3));if(1>=_o(n.h)&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else ha(n,11)}else if((e.J||n.g==e)&&ca(n),!Qr(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.I=u[1],n.ka=u[2];const t=u[3];null!=t&&(n.ma=t,n.j.info("VER="+n.ma));const i=u[4];null!=i&&(n.Ca=i,n.j.info("SVER="+n.Ca));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(To(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.za=e,eo(r.F,r.D,e))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=e;if((r=n).sa=fa(r,r.H?r.ka:null,r.V),o.J){Eo(r.h,o);var a=o,c=r.J;c&&a.setTimeout(c),a.B&&($s(a),js(a)),r.g=o}else ia(r);0<n.i.length&&ea(n)}else"stop"!=u[0]&&"close"!=u[0]||ha(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ha(n,7):Jo(n):"noop"!=u[0]&&n.l&&n.l.wa(u),n.A=0)}ms()}catch(e){}}function Gs(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Lr(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Lr(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Lr(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(Ar=Ds.prototype).setTimeout=function(e){this.O=e},Ar.ib=function(e){e=e.target;const t=this.L;t&&3==Ho(e)?t.l():this.La(e)},Ar.La=function(e){try{if(e==this.g)e:{const l=Ho(this.g);var t=this.g.Ea();if(this.g.aa(),!(3>l)&&(3!=l||oi||this.g&&(this.h.h||this.g.fa()||zo(this.g)))){this.I||4!=l||7==t||ms(),$s(this);var n=this.g.aa();this.Y=n;t:if(Fs(this)){var r=zo(this.g);e="";var i=r.length,s=4==Ho(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Hs(this),Ks(this);var o="";break t}this.h.i=new Or.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.U,l,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Qr(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,vs(12),Hs(this),Ks(this);break e}hs(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,zs(this,n)}this.P?(Vs(this,l,o),oi&&this.i&&3==l&&(cs(this.S,this.T,"tick",this.hb),this.T.start())):(hs(this.j,this.m,o,null),zs(this,o)),4==l&&Hs(this),this.i&&!this.I&&(4==l?ua(this.l,this):(this.i=!1,js(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,vs(12)):(this.o=0,vs(13)),Hs(this),Ks(this)}}}catch(e){}},Ar.hb=function(){if(this.g){var e=Ho(this.g),t=this.g.fa();this.C<t.length&&($s(this),Vs(this,e,t),this.i&&4!=e&&js(this))}},Ar.cancel=function(){this.I=!0,Hs(this)},Ar.gb=function(){this.B=null;const e=Date.now();0<=e-this.V?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(ms(),vs(17)),Hs(this),this.o=2,Ks(this)):qs(this,this.V-e)};var Ws=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Qs(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Qs){this.h=void 0!==t?t:e.h,Js(this,e.j),this.s=e.s,this.g=e.g,Ys(this,e.m),this.l=e.l,t=e.i;var n=new lo;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Zs(this,n),this.o=e.o}else e&&(n=String(e).match(Ws))?(this.h=!!t,Js(this,n[1]||"",!0),this.s=no(n[2]||""),this.g=no(n[3]||"",!0),Ys(this,n[4]),this.l=no(n[5]||"",!0),Zs(this,n[6]||"",!0),this.o=no(n[7]||"")):(this.h=!!t,this.i=new lo(null,this.h))}function Xs(e){return new Qs(e)}function Js(e,t,n){e.j=n?no(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ys(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Zs(e,t,n){t instanceof lo?(e.i=t,function(e,t){t&&!e.j&&(ho(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(fo(this,t),go(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=ro(t,co)),e.i=new lo(t,e.h))}function eo(e,t,n){e.i.set(t,n)}function to(e){return eo(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function no(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ro(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,io),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function io(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Qs.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ro(t,so,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(ro(t,so,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ro(n,"/"==n.charAt(0)?ao:oo,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",ro(n,uo)),e.join("")};var so=/[#\/\?@]/g,oo=/[#\?:]/g,ao=/[#\?]/g,co=/[#\?@]/g,uo=/#/g;function lo(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ho(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function fo(e,t){ho(e),t=mo(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function po(e,t){return ho(e),t=mo(e,t),e.g.has(t)}function go(e,t,n){fo(e,t),0<n.length&&(e.i=null,e.g.set(mo(e,t),Hr(n)),e.h+=n.length)}function mo(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function yo(e){this.l=e||vo,e=Or.PerformanceNavigationTiming?0<(e=Or.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Or.g&&Or.g.Ga&&Or.g.Ga()&&Or.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Ar=lo.prototype).add=function(e,t){ho(this),this.i=null,e=mo(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Ar.forEach=function(e,t){ho(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},Ar.oa=function(){ho(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},Ar.W=function(e){ho(this);let t=[];if("string"==typeof e)po(this,e)&&(t=t.concat(this.g.get(mo(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Ar.set=function(e,t){return ho(this),this.i=null,po(this,e=mo(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Ar.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},Ar.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var vo=10;function wo(e){return!!e.h||!!e.g&&e.g.size>=e.j}function _o(e){return e.h?1:e.g?e.g.size:0}function bo(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function To(e,t){e.g?e.g.add(t):e.h=t}function Eo(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Io(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return Hr(e.i)}function ko(){}function So(){this.g=new ko}function Co(e,t,n){const r=n||"";try{Gs(e,(function(e,n){let i=e;Mr(e)&&(i=Hi(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Ao(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Ro(e){this.l=e.ac||null,this.j=e.jb||!1}function No(e,t){qi.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Do,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}yo.prototype.cancel=function(){if(this.i=Io(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},ko.prototype.stringify=function(e){return Or.JSON.stringify(e,void 0)},ko.prototype.parse=function(e){return Or.JSON.parse(e,void 0)},qr(Ro,Es),Ro.prototype.g=function(){return new No(this.l,this.j)},Ro.prototype.i=function(e){return function(){return e}}({}),qr(No,qi);var Do=0;function Oo(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function Po(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Lo(e)}function Lo(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Ar=No.prototype).open=function(e,t){if(this.readyState!=Do)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Lo(this)},Ar.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||Or).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},Ar.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Po(this)),this.readyState=Do},Ar.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Lo(this)),this.g&&(this.readyState=3,Lo(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==Or.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Oo(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},Ar.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Po(this):Lo(this),3==this.readyState&&Oo(this)}},Ar.Va=function(e){this.g&&(this.response=this.responseText=e,Po(this))},Ar.Ua=function(e){this.g&&(this.response=e,Po(this))},Ar.ga=function(){this.g&&Po(this)},Ar.setRequestHeader=function(e,t){this.v.append(e,t)},Ar.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Ar.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(No.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Mo=Or.JSON.parse;function xo(e){qi.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Uo,this.K=this.L=!1}qr(xo,qi);var Uo="",Fo=/^https?$/i,Vo=["POST","PUT"];function Bo(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,jo(e),$o(e)}function jo(e){e.D||(e.D=!0,$i(e,"complete"),$i(e,"error"))}function qo(e){if(e.h&&void 0!==Dr&&(!e.C[1]||4!=Ho(e)||2!=e.aa()))if(e.v&&4==Ho(e))rs(e.Ha,0,e);else if($i(e,"readystatechange"),4==Ho(e)){e.h=!1;try{const a=e.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(Ws)[1]||null;if(!i&&Or.self&&Or.self.location){var s=Or.self.location.protocol;i=s.substr(0,s.length-1)}r=!Fo.test(i?i.toLowerCase():"")}n=r}if(n)$i(e,"complete"),$i(e,"success");else{e.m=6;try{var o=2<Ho(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",jo(e)}}finally{$o(e)}}}function $o(e,t){if(e.g){Ko(e);const n=e.g,r=e.C[0]?Pr:null;e.g=null,e.C=null,t||$i(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Ko(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(Or.clearTimeout(e.A),e.A=null)}function Ho(e){return e.g?e.g.readyState:0}function zo(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Uo:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Go(e){let t="";return Ei(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Wo(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Go(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):eo(e,t,n))}function Qo(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Xo(e){this.Ca=0,this.i=[],this.j=new ls,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Qo("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Qo("baseRetryDelayMs",5e3,e),this.bb=Qo("retryDelaySeedMs",1e4,e),this.$a=Qo("forwardChannelMaxRetries",2,e),this.ta=Qo("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new yo(e&&e.concurrentRequestLimit),this.Fa=new So,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Jo(e){if(Zo(e),3==e.G){var t=e.U++,n=Xs(e.F);eo(n,"SID",e.I),eo(n,"RID",t),eo(n,"TYPE","terminate"),na(e,n),(t=new Ds(e,e.j,t,void 0)).K=2,t.v=to(Xs(n)),n=!1,Or.navigator&&Or.navigator.sendBeacon&&(n=Or.navigator.sendBeacon(t.v.toString(),"")),!n&&Or.Image&&((new Image).src=t.v,n=!0),n||(t.g=pa(t.l,null),t.g.da(t.v)),t.F=Date.now(),js(t)}da(e)}function Yo(e){e.g&&(oa(e),e.g.cancel(),e.g=null)}function Zo(e){Yo(e),e.u&&(Or.clearTimeout(e.u),e.u=null),ca(e),e.h.cancel(),e.m&&("number"==typeof e.m&&Or.clearTimeout(e.m),e.m=null)}function ea(e){wo(e.h)||e.m||(e.m=!0,Ji(e.Ja,e),e.C=0)}function ta(e,t){var n;n=t?t.m:e.U++;const r=Xs(e.F);eo(r,"SID",e.I),eo(r,"RID",n),eo(r,"AID",e.T),na(e,r),e.o&&e.s&&Wo(r,e.o,e.s),n=new Ds(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=ra(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),To(e.h,n),xs(n,r,t)}function na(e,t){e.ia&&Ei(e.ia,(function(e,n){eo(t,n,e)})),e.l&&Gs({},(function(e,n){eo(t,n,e)}))}function ra(e,t,n){n=Math.min(e.i.length,n);var r=e.l?Br(e.l.Ra,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{Co(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function ia(e){e.g||e.u||(e.Z=1,Ji(e.Ia,e),e.A=0)}function sa(e){return!(e.g||e.u||3<=e.A||(e.Z++,e.u=_s(Br(e.Ia,e),la(e,e.A)),e.A++,0))}function oa(e){null!=e.B&&(Or.clearTimeout(e.B),e.B=null)}function aa(e){e.g=new Ds(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Xs(e.sa);eo(t,"RID","rpc"),eo(t,"SID",e.I),eo(t,"CI",e.L?"0":"1"),eo(t,"AID",e.T),eo(t,"TYPE","xmlhttp"),na(e,t),e.o&&e.s&&Wo(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=to(Xs(t)),n.s=null,n.P=!0,Us(n,e)}function ca(e){null!=e.v&&(Or.clearTimeout(e.v),e.v=null)}function ua(e,t){var n=null;if(e.g==t){ca(e),oa(e),e.g=null;var r=2}else{if(!bo(e.h,t))return;n=t.D,Eo(e.h,t),r=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;$i(r=ps(),new ws(r,n)),ea(e)}else ia(e);else if(3==(i=t.o)||0==i&&0<e.pa||!(1==r&&function(e,t){return!(_o(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.C>=(e.Za?0:e.$a)||(e.m=_s(Br(e.Ja,e,t),la(e,e.C)),e.C++,0)))}(e,t)||2==r&&sa(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:ha(e,5);break;case 4:ha(e,10);break;case 3:ha(e,6);break;default:ha(e,2)}}function la(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function ha(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=Br(e.kb,e);n||(n=new Qs("//www.google.com/images/cleardot.gif"),Or.location&&"http"==Or.location.protocol||Js(n,"https"),to(n)),function(e,t){const n=new ls;if(Or.Image){const r=new Image;r.onload=jr(Ao,n,r,"TestLoadImage: loaded",!0,t),r.onerror=jr(Ao,n,r,"TestLoadImage: error",!1,t),r.onabort=jr(Ao,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=jr(Ao,n,r,"TestLoadImage: timeout",!1,t),Or.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else vs(2);e.G=0,e.l&&e.l.va(t),da(e),Zo(e)}function da(e){if(e.G=0,e.la=[],e.l){const t=Io(e.h);0==t.length&&0==e.i.length||(zr(e.la,t),zr(e.la,e.i),e.h.i.length=0,Hr(e.i),e.i.length=0),e.l.ua()}}function fa(e,t,n){var r=n instanceof Qs?Xs(n):new Qs(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),Ys(r,r.m);else{var i=Or.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Qs(null,void 0);r&&Js(s,r),t&&(s.g=t),i&&Ys(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.za,n&&t&&eo(r,n,t),eo(r,"VER",e.ma),na(e,r),r}function pa(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new xo(new Ro({jb:!0})):new xo(e.ra)).Ka(e.H),t}function ga(){}function ma(){if(ii&&!(10<=Number(mi)))throw Error("Environmental error: no available transport.")}function ya(e,t){qi.call(this),this.g=new Xo(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!Qr(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Qr(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new _a(this)}function va(e){As.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function wa(){Rs.call(this),this.status=1}function _a(e){this.g=e}(Ar=xo.prototype).Ka=function(e){this.L=e},Ar.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ss.g(),this.C=this.u?Is(this.u):Is(Ss),this.g.onreadystatechange=Br(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Bo(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=Or.FormData&&e instanceof Or.FormData,!(0<=Kr(Vo,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ko(this),0<this.B&&((this.K=function(e){return ii&&gi()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Br(this.qa,this)):this.A=rs(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Bo(this,e)}},Ar.qa=function(){void 0!==Dr&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,$i(this,"timeout"),this.abort(8))},Ar.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,$i(this,"complete"),$i(this,"abort"),$o(this))},Ar.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),$o(this,!0)),xo.X.M.call(this)},Ar.Ha=function(){this.s||(this.F||this.v||this.l?qo(this):this.fb())},Ar.fb=function(){qo(this)},Ar.aa=function(){try{return 2<Ho(this)?this.g.status:-1}catch(e){return-1}},Ar.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Ar.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Mo(t)}},Ar.Ea=function(){return this.m},Ar.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Ar=Xo.prototype).ma=8,Ar.G=1,Ar.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Ds(this,this.j,e,void 0);let s=this.s;if(this.S&&(s?(s=Ii(s),Si(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ra(this,i,t),eo(n=Xs(this.F),"RID",e),eo(n,"CVER",22),this.D&&eo(n,"X-HTTP-Session-Id",this.D),na(this,n),s&&(this.N?t="headers="+encodeURIComponent(String(Go(s)))+"&"+t:this.o&&Wo(n,this.o,s)),To(this.h,i),this.Ya&&eo(n,"TYPE","init"),this.O?(eo(n,"$req",t),eo(n,"SID","null"),i.Z=!0,xs(i,n,null)):xs(i,n,t),this.G=2}}else 3==this.G&&(e?ta(this,e):0==this.i.length||wo(this.h)||ta(this))},Ar.Ia=function(){if(this.u=null,aa(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=_s(Br(this.eb,this),e)}},Ar.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,vs(10),Yo(this),aa(this))},Ar.cb=function(){null!=this.v&&(this.v=null,Yo(this),sa(this),vs(19))},Ar.kb=function(e){e?(this.j.info("Successfully pinged google.com"),vs(2)):(this.j.info("Failed to ping google.com"),vs(1))},(Ar=ga.prototype).xa=function(){},Ar.wa=function(){},Ar.va=function(){},Ar.ua=function(){},Ar.Ra=function(){},ma.prototype.g=function(e,t){return new ya(e,t)},qr(ya,qi),ya.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;vs(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=fa(e,null,e.V),ea(e)},ya.prototype.close=function(){Jo(this.g)},ya.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Hi(e),e=n);t.i.push(new class{constructor(e,t){this.h=e,this.g=t}}(t.ab++,e)),3==t.G&&ea(t)},ya.prototype.M=function(){this.g.l=null,delete this.j,Jo(this.g),delete this.g,ya.X.M.call(this)},qr(va,As),qr(wa,Rs),qr(_a,ga),_a.prototype.xa=function(){$i(this.g,"a")},_a.prototype.wa=function(e){$i(this.g,new va(e))},_a.prototype.va=function(e){$i(this.g,new wa)},_a.prototype.ua=function(){$i(this.g,"b")},ma.prototype.createWebChannel=ma.prototype.g,ya.prototype.send=ya.prototype.u,ya.prototype.open=ya.prototype.m,ya.prototype.close=ya.prototype.close,bs.NO_ERROR=0,bs.TIMEOUT=8,bs.HTTP_ERROR=6,Ts.COMPLETE="complete",ks.EventType=Cs,Cs.OPEN="a",Cs.CLOSE="b",Cs.ERROR="c",Cs.MESSAGE="d",qi.prototype.listen=qi.prototype.N,xo.prototype.listenOnce=xo.prototype.O,xo.prototype.getLastError=xo.prototype.Oa,xo.prototype.getLastErrorCode=xo.prototype.Ea,xo.prototype.getStatus=xo.prototype.aa,xo.prototype.getResponseJson=xo.prototype.Sa,xo.prototype.getResponseText=xo.prototype.fa,xo.prototype.send=xo.prototype.da,xo.prototype.setWithCredentials=xo.prototype.Ka;var ba=Nr.createWebChannelTransport=function(){return new ma},Ta=Nr.getStatEventTarget=function(){return ps()},Ea=Nr.ErrorCode=bs,Ia=Nr.EventType=Ts,ka=Nr.Event=ds,Sa=Nr.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Ca=Nr.FetchXmlHttpFactory=Ro,Aa=Nr.WebChannel=ks,Ra=Nr.XhrIo=xo;const Na="@firebase/firestore";class Da{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Da.UNAUTHENTICATED=new Da(null),Da.GOOGLE_CREDENTIALS=new Da("google-credentials-uid"),Da.FIRST_PARTY=new Da("first-party-uid"),Da.MOCK_USER=new Da("mock-user");let Oa="9.17.1";const Pa=new K("@firebase/firestore");function La(){return Pa.logLevel}function Ma(e,...t){if(Pa.logLevel<=F.DEBUG){const n=t.map(Fa);Pa.debug(`Firestore (${Oa}): ${e}`,...n)}}function xa(e,...t){if(Pa.logLevel<=F.ERROR){const n=t.map(Fa);Pa.error(`Firestore (${Oa}): ${e}`,...n)}}function Ua(e,...t){if(Pa.logLevel<=F.WARN){const n=t.map(Fa);Pa.warn(`Firestore (${Oa}): ${e}`,...n)}}function Fa(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Va(e="Unexpected state"){const t=`FIRESTORE (${Oa}) INTERNAL ASSERTION FAILED: `+e;throw xa(t),new Error(t)}function Ba(e,t){e||Va()}function ja(e,t){return e}const qa={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $a extends y{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ka{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Ha{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class za{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Da.UNAUTHENTICATED)))}shutdown(){}}class Ga{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Wa{constructor(e){this.t=e,this.currentUser=Da.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Ka;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ka,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Ma("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Ma("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ka)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Ma("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Ba("string"==typeof t.accessToken),new Ha(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Ba(null===e||"string"==typeof e),new Da(e)}}class Qa{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=Da.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(Ba(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Xa{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new Qa(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable((()=>t(Da.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ja{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ya{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const n=e=>{null!=e.error&&Ma("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.A;return this.A=e.token,Ma("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Ma("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.T.getImmediate({optional:!0});e?r(e):Ma("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Ba("string"==typeof e.token),this.A=e.token,new Ja(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Za(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class ec{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=Za(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function tc(e,t){return e<t?-1:e>t?1:0}function nc(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class rc{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new $a(qa.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new $a(qa.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new $a(qa.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new $a(qa.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return rc.fromMillis(Date.now())}static fromDate(e){return rc.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new rc(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tc(this.nanoseconds,e.nanoseconds):tc(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ic{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ic(e)}static min(){return new ic(new rc(0,0))}static max(){return new ic(new rc(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class sc{constructor(e,t,n){void 0===t?t=0:t>e.length&&Va(),void 0===n?n=e.length-t:n>e.length-t&&Va(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===sc.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof sc?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class oc extends sc{construct(e,t,n){return new oc(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new $a(qa.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new oc(t)}static emptyPath(){return new oc([])}}const ac=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class cc extends sc{construct(e,t,n){return new cc(e,t,n)}static isValidIdentifier(e){return ac.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),cc.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new cc(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new $a(qa.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new $a(qa.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new $a(qa.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new $a(qa.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new cc(t)}static emptyPath(){return new cc([])}}class uc{constructor(e){this.path=e}static fromPath(e){return new uc(oc.fromString(e))}static fromName(e){return new uc(oc.fromString(e).popFirst(5))}static empty(){return new uc(oc.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===oc.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return oc.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new uc(new oc(e.slice()))}}function lc(e){return new hc(e.readTime,e.key,-1)}class hc{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new hc(ic.min(),uc.empty(),-1)}static max(){return new hc(ic.max(),uc.empty(),-1)}}function dc(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=uc.comparator(e.documentKey,t.documentKey),0!==n?n:tc(e.largestBatchId,t.largestBatchId))}const fc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function gc(e){if(e.code!==qa.FAILED_PRECONDITION||e.message!==fc)throw e;Ma("LocalStore","Unexpectedly lost primary lease")}class mc{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Va(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new mc(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof mc?t:mc.resolve(t)}catch(e){return mc.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):mc.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):mc.reject(t)}static resolve(e){return new mc(((t,n)=>{t(e)}))}static reject(e){return new mc(((t,n)=>{n(e)}))}static waitFor(e){return new mc(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=mc.resolve(!1);for(const n of e)t=t.next((e=>e?mc.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new mc(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new mc(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}function yc(e){return"IndexedDbTransactionError"===e.name}class vc{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}vc.at=-1;class wc{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class _c{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new _c("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof _c&&e.projectId===this.projectId&&e.database===this.database}}function bc(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Tc(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ec(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Ic(e){return null==e}function kc(e){return 0===e&&1/e==-1/0}class Sc{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Sc(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Sc(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tc(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Sc.EMPTY_BYTE_STRING=new Sc("");const Cc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ac(e){if(Ba(!!e),"string"==typeof e){let t=0;const n=Cc.exec(e);if(Ba(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Rc(e.seconds),nanos:Rc(e.nanos)}}function Rc(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Nc(e){return"string"==typeof e?Sc.fromBase64String(e):Sc.fromUint8Array(e)}function Dc(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Oc(e){const t=e.mapValue.fields.__previous_value__;return Dc(t)?Oc(t):t}function Pc(e){const t=Ac(e.mapValue.fields.__local_write_time__.timestampValue);return new rc(t.seconds,t.nanos)}const Lc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Mc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Dc(e)?4:Qc(e)?9007199254740991:10:Va()}function xc(e,t){if(e===t)return!0;const n=Mc(e);if(n!==Mc(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Pc(e).isEqual(Pc(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ac(e.timestampValue),r=Ac(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Nc(e.bytesValue).isEqual(Nc(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Rc(e.geoPointValue.latitude)===Rc(t.geoPointValue.latitude)&&Rc(e.geoPointValue.longitude)===Rc(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Rc(e.integerValue)===Rc(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Rc(e.doubleValue),r=Rc(t.doubleValue);return n===r?kc(n)===kc(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return nc(e.arrayValue.values||[],t.arrayValue.values||[],xc);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(bc(n)!==bc(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!xc(n[e],r[e])))return!1;return!0}(e,t);default:return Va()}}function Uc(e,t){return void 0!==(e.values||[]).find((e=>xc(e,t)))}function Fc(e,t){if(e===t)return 0;const n=Mc(e),r=Mc(t);if(n!==r)return tc(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return tc(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Rc(e.integerValue||e.doubleValue),r=Rc(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Vc(e.timestampValue,t.timestampValue);case 4:return Vc(Pc(e),Pc(t));case 5:return tc(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Nc(e),r=Nc(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=tc(n[e],r[e]);if(0!==t)return t}return tc(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=tc(Rc(e.latitude),Rc(t.latitude));return 0!==n?n:tc(Rc(e.longitude),Rc(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Fc(n[e],r[e]);if(t)return t}return tc(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Lc.mapValue&&t===Lc.mapValue)return 0;if(e===Lc.mapValue)return 1;if(t===Lc.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=tc(r[e],s[e]);if(0!==t)return t;const o=Fc(n[r[e]],i[s[e]]);if(0!==o)return o}return tc(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Va()}}function Vc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return tc(e,t);const n=Ac(e),r=Ac(t),i=tc(n.seconds,r.seconds);return 0!==i?i:tc(n.nanos,r.nanos)}function Bc(e){return jc(e)}function jc(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ac(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Nc(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,uc.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=jc(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${jc(e.fields[i])}`;return n+"}"}(e.mapValue):Va();var t,n}function qc(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function $c(e){return!!e&&"integerValue"in e}function Kc(e){return!!e&&"arrayValue"in e}function Hc(e){return!!e&&"nullValue"in e}function zc(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Gc(e){return!!e&&"mapValue"in e}function Wc(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Tc(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Wc(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Wc(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Qc(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Xc{constructor(e,t){this.position=e,this.inclusive=t}}function Jc(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?uc.comparator(uc.fromName(o.referenceValue),n.key):Fc(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Yc(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!xc(e.position[n],t.position[n]))return!1;return!0}class Zc{}class eu extends Zc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new au(e,t,n):"array-contains"===t?new hu(e,n):"in"===t?new du(e,n):"not-in"===t?new fu(e,n):"array-contains-any"===t?new pu(e,n):new eu(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new cu(e,n):new uu(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Fc(t,this.value)):null!==t&&Mc(this.value)===Mc(t)&&this.matchesComparison(Fc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Va()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class tu extends Zc{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new tu(e,t)}matches(e){return nu(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt((e=>e.isInequality()));return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function nu(e){return"and"===e.op}function ru(e){return function(e){for(const t of e.filters)if(t instanceof tu)return!1;return!0}(e)&&nu(e)}function iu(e){if(e instanceof eu)return e.field.canonicalString()+e.op.toString()+Bc(e.value);if(ru(e))return e.filters.map((e=>iu(e))).join(",");{const t=e.filters.map((e=>iu(e))).join(",");return`${e.op}(${t})`}}function su(e,t){return e instanceof eu?function(e,t){return t instanceof eu&&e.op===t.op&&e.field.isEqual(t.field)&&xc(e.value,t.value)}(e,t):e instanceof tu?function(e,t){return t instanceof tu&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&su(n,t.filters[r])),!0)}(e,t):void Va()}function ou(e){return e instanceof eu?function(e){return`${e.field.canonicalString()} ${e.op} ${Bc(e.value)}`}(e):e instanceof tu?function(e){return e.op.toString()+" {"+e.getFilters().map(ou).join(" ,")+"}"}(e):"Filter"}class au extends eu{constructor(e,t,n){super(e,t,n),this.key=uc.fromName(n.referenceValue)}matches(e){const t=uc.comparator(e.key,this.key);return this.matchesComparison(t)}}class cu extends eu{constructor(e,t){super(e,"in",t),this.keys=lu(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class uu extends eu{constructor(e,t){super(e,"not-in",t),this.keys=lu(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function lu(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>uc.fromName(e.referenceValue)))}class hu extends eu{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Kc(t)&&Uc(t.arrayValue,this.value)}}class du extends eu{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Uc(this.value.arrayValue,t)}}class fu extends eu{constructor(e,t){super(e,"not-in",t)}matches(e){if(Uc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Uc(this.value.arrayValue,t)}}class pu extends eu{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Kc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Uc(this.value.arrayValue,e)))}}class gu{constructor(e,t="asc"){this.field=e,this.dir=t}}function mu(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class yu{constructor(e,t){this.comparator=e,this.root=t||wu.EMPTY}insert(e,t){return new yu(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,wu.BLACK,null,null))}remove(e){return new yu(this.comparator,this.root.remove(e,this.comparator).copy(null,null,wu.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vu(this.root,e,this.comparator,!1)}getReverseIterator(){return new vu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vu(this.root,e,this.comparator,!0)}}class vu{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class wu{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:wu.RED,this.left=null!=r?r:wu.EMPTY,this.right=null!=i?i:wu.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new wu(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return wu.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return wu.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,wu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,wu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Va();if(this.right.isRed())throw Va();const e=this.left.check();if(e!==this.right.check())throw Va();return e+(this.isRed()?0:1)}}wu.EMPTY=null,wu.RED=!0,wu.BLACK=!1,wu.EMPTY=new class{constructor(){this.size=0}get key(){throw Va()}get value(){throw Va()}get color(){throw Va()}get left(){throw Va()}get right(){throw Va()}copy(e,t,n,r,i){return this}insert(e,t,n){return new wu(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class _u{constructor(e){this.comparator=e,this.data=new yu(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new bu(this.data.getIterator())}getIteratorFrom(e){return new bu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof _u))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new _u(this.comparator);return t.data=e,t}}class bu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Tu{constructor(e){this.fields=e,e.sort(cc.comparator)}static empty(){return new Tu([])}unionWith(e){let t=new _u(cc.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Tu(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return nc(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Eu{constructor(e){this.value=e}static empty(){return new Eu({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Gc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Wc(t)}setAll(e){let t=cc.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Wc(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Gc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return xc(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Gc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Tc(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Eu(Wc(this.value))}}function Iu(e){const t=[];return Tc(e.fields,((e,n)=>{const r=new cc([e]);if(Gc(n)){const e=Iu(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Tu(t)}class ku{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new ku(e,0,ic.min(),ic.min(),ic.min(),Eu.empty(),0)}static newFoundDocument(e,t,n,r){return new ku(e,1,t,ic.min(),n,r,0)}static newNoDocument(e,t){return new ku(e,2,t,ic.min(),ic.min(),Eu.empty(),0)}static newUnknownDocument(e,t){return new ku(e,3,t,ic.min(),ic.min(),Eu.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ic.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Eu.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Eu.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ic.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ku&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ku(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Su{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ft=null}}function Cu(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Su(e,t,n,r,i,s,o)}function Au(e){const t=ja(e);if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>iu(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Ic(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Bc(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Bc(e))).join(",")),t.ft=e}return t.ft}function Ru(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!mu(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!su(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Yc(e.startAt,t.startAt)&&Yc(e.endAt,t.endAt)}function Nu(e){return uc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Du{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.dt=null,this._t=null,this.startAt,this.endAt}}function Ou(e){return new Du(e)}function Pu(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Lu(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Mu(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function xu(e){return null!==e.collectionGroup}function Uu(e){const t=ja(e);if(null===t.dt){t.dt=[];const e=Mu(t),n=Lu(t);if(null!==e&&null===n)e.isKeyField()||t.dt.push(new gu(e)),t.dt.push(new gu(cc.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.dt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.dt.push(new gu(cc.keyField(),e))}}}return t.dt}function Fu(e){const t=ja(e);if(!t._t)if("F"===t.limitType)t._t=Cu(t.path,t.collectionGroup,Uu(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Uu(t)){const t="desc"===n.dir?"asc":"desc";e.push(new gu(n.field,t))}const n=t.endAt?new Xc(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Xc(t.startAt.position,t.startAt.inclusive):null;t._t=Cu(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function Vu(e,t){t.getFirstInequalityField(),Mu(e);const n=e.filters.concat([t]);return new Du(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Bu(e,t,n){return new Du(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ju(e,t){return Ru(Fu(e),Fu(t))&&e.limitType===t.limitType}function qu(e){return`${Au(Fu(e))}|lt:${e.limitType}`}function $u(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>ou(e))).join(", ")}]`),Ic(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Bc(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Bc(e))).join(",")),`Target(${t})`}(Fu(e))}; limitType=${e.limitType})`}function Ku(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):uc.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Uu(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Jc(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Uu(e),t)||e.endAt&&!function(e,t,n){const r=Jc(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Uu(e),t))}(e,t)}function Hu(e){return(t,n)=>{let r=!1;for(const i of Uu(e)){const e=zu(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function zu(e,t,n){const r=e.field.isKeyField()?uc.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Fc(r,i):Va()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Va()}}function Gu(e,t){if(e.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:kc(t)?"-0":t}}function Wu(e){return{integerValue:""+e}}function Qu(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!kc(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Wu(t):Gu(e,t)}class Xu{constructor(){this._=void 0}}function Ju(e,t,n){return e instanceof el?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof tl?nl(e,t):e instanceof rl?il(e,t):function(e,t){const n=Zu(e,t),r=ol(n)+ol(e.gt);return $c(n)&&$c(e.gt)?Wu(r):Gu(e.yt,r)}(e,t)}function Yu(e,t,n){return e instanceof tl?nl(e,t):e instanceof rl?il(e,t):n}function Zu(e,t){return e instanceof sl?$c(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class el extends Xu{}class tl extends Xu{constructor(e){super(),this.elements=e}}function nl(e,t){const n=al(t);for(const t of e.elements)n.some((e=>xc(e,t)))||n.push(t);return{arrayValue:{values:n}}}class rl extends Xu{constructor(e){super(),this.elements=e}}function il(e,t){let n=al(t);for(const t of e.elements)n=n.filter((e=>!xc(e,t)));return{arrayValue:{values:n}}}class sl extends Xu{constructor(e,t){super(),this.yt=e,this.gt=t}}function ol(e){return Rc(e.integerValue||e.doubleValue)}function al(e){return Kc(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class cl{constructor(e,t){this.field=e,this.transform=t}}class ul{constructor(e,t){this.version=e,this.transformResults=t}}class ll{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ll}static exists(e){return new ll(void 0,e)}static updateTime(e){return new ll(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hl(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class dl{}function fl(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new El(e.key,ll.none()):new vl(e.key,e.data,ll.none());{const n=e.data,r=Eu.empty();let i=new _u(cc.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new wl(e.key,r,new Tu(i.toArray()),ll.none())}}function pl(e,t,n){e instanceof vl?function(e,t,n){const r=e.value.clone(),i=bl(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof wl?function(e,t,n){if(!hl(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=bl(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(_l(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function gl(e,t,n,r){return e instanceof vl?function(e,t,n,r){if(!hl(e.precondition,t))return n;const i=e.value.clone(),s=Tl(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof wl?function(e,t,n,r){if(!hl(e.precondition,t))return n;const i=Tl(e.fieldTransforms,r,t),s=t.data;return s.setAll(_l(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return hl(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function ml(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Zu(r.transform,e||null);null!=i&&(null===n&&(n=Eu.empty()),n.set(r.field,i))}return n||null}function yl(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&nc(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof tl&&t instanceof tl||e instanceof rl&&t instanceof rl?nc(e.elements,t.elements,xc):e instanceof sl&&t instanceof sl?xc(e.gt,t.gt):e instanceof el&&t instanceof el}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class vl extends dl{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class wl extends dl{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function _l(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function bl(e,t,n){const r=new Map;Ba(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Yu(o,a,n[i]))}return r}function Tl(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Ju(e,s,t))}return r}class El extends dl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Il extends dl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class kl{constructor(e){this.count=e}}var Sl,Cl;function Al(e){if(void 0===e)return xa("GRPC error has no .code"),qa.UNKNOWN;switch(e){case Sl.OK:return qa.OK;case Sl.CANCELLED:return qa.CANCELLED;case Sl.UNKNOWN:return qa.UNKNOWN;case Sl.DEADLINE_EXCEEDED:return qa.DEADLINE_EXCEEDED;case Sl.RESOURCE_EXHAUSTED:return qa.RESOURCE_EXHAUSTED;case Sl.INTERNAL:return qa.INTERNAL;case Sl.UNAVAILABLE:return qa.UNAVAILABLE;case Sl.UNAUTHENTICATED:return qa.UNAUTHENTICATED;case Sl.INVALID_ARGUMENT:return qa.INVALID_ARGUMENT;case Sl.NOT_FOUND:return qa.NOT_FOUND;case Sl.ALREADY_EXISTS:return qa.ALREADY_EXISTS;case Sl.PERMISSION_DENIED:return qa.PERMISSION_DENIED;case Sl.FAILED_PRECONDITION:return qa.FAILED_PRECONDITION;case Sl.ABORTED:return qa.ABORTED;case Sl.OUT_OF_RANGE:return qa.OUT_OF_RANGE;case Sl.UNIMPLEMENTED:return qa.UNIMPLEMENTED;case Sl.DATA_LOSS:return qa.DATA_LOSS;default:return Va()}}(Cl=Sl||(Sl={}))[Cl.OK=0]="OK",Cl[Cl.CANCELLED=1]="CANCELLED",Cl[Cl.UNKNOWN=2]="UNKNOWN",Cl[Cl.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Cl[Cl.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Cl[Cl.NOT_FOUND=5]="NOT_FOUND",Cl[Cl.ALREADY_EXISTS=6]="ALREADY_EXISTS",Cl[Cl.PERMISSION_DENIED=7]="PERMISSION_DENIED",Cl[Cl.UNAUTHENTICATED=16]="UNAUTHENTICATED",Cl[Cl.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Cl[Cl.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Cl[Cl.ABORTED=10]="ABORTED",Cl[Cl.OUT_OF_RANGE=11]="OUT_OF_RANGE",Cl[Cl.UNIMPLEMENTED=12]="UNIMPLEMENTED",Cl[Cl.INTERNAL=13]="INTERNAL",Cl[Cl.UNAVAILABLE=14]="UNAVAILABLE",Cl[Cl.DATA_LOSS=15]="DATA_LOSS";class Rl{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Tc(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Ec(this.inner)}size(){return this.innerSize}}const Nl=new yu(uc.comparator);function Dl(){return Nl}const Ol=new yu(uc.comparator);function Pl(...e){let t=Ol;for(const n of e)t=t.insert(n.key,n);return t}function Ll(e){let t=Ol;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Ml(){return Ul()}function xl(){return Ul()}function Ul(){return new Rl((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Fl=new yu(uc.comparator),Vl=new _u(uc.comparator);function Bl(...e){let t=Vl;for(const n of e)t=t.add(n);return t}const jl=new _u(tc);function ql(){return jl}class $l{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Kl.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new $l(ic.min(),r,ql(),Dl(),Bl())}}class Kl{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Kl(n,t,Bl(),Bl(),Bl())}}class Hl{constructor(e,t,n,r){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=r}}class zl{constructor(e,t){this.targetId=e,this.Et=t}}class Gl{constructor(e,t,n=Sc.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Wl{constructor(){this.At=0,this.Rt=Jl(),this.bt=Sc.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=Bl(),t=Bl(),n=Bl();return this.Rt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Va()}})),new Kl(this.bt,this.Pt,e,t,n)}xt(){this.vt=!1,this.Rt=Jl()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class Ql{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=Dl(),this.qt=Xl(),this.Ut=new _u(tc)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,(t=>{const n=this.Wt(t);switch(e.state){case 0:this.zt(t)&&n.Dt(e.resumeToken);break;case 1:n.Mt(),n.Vt||n.xt(),n.Dt(e.resumeToken);break;case 2:n.Mt(),n.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(n.Ft(),n.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),n.Dt(e.resumeToken));break;default:Va()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach(((e,n)=>{this.zt(n)&&t(n)}))}Jt(e){const t=e.targetId,n=e.Et.count,r=this.Yt(t);if(r){const e=r.target;if(Nu(e))if(0===n){const n=new uc(e.path);this.Qt(t,n,ku.newNoDocument(n,ic.min()))}else Ba(1===n);else this.Xt(t)!==n&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach(((n,r)=>{const i=this.Yt(r);if(i){if(n.current&&Nu(i.target)){const t=new uc(i.target.path);null!==this.Lt.get(t)||this.te(r,t)||this.Qt(r,t,ku.newNoDocument(t,e))}n.St&&(t.set(r,n.Ct()),n.xt())}}));let n=Bl();this.qt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Yt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Lt.forEach(((t,n)=>n.setReadTime(e)));const r=new $l(e,t,this.Ut,this.Lt,n);return this.Lt=Dl(),this.qt=Xl(),this.Ut=new _u(tc),r}Gt(e,t){if(!this.zt(e))return;const n=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,n){if(!this.zt(e))return;const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new Wl,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new _u(tc),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||Ma("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new Wl),this.$t.getRemoteKeysForTarget(e).forEach((t=>{this.Qt(e,t,null)}))}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function Xl(){return new yu(uc.comparator)}function Jl(){return new yu(uc.comparator)}const Yl={asc:"ASCENDING",desc:"DESCENDING"},Zl={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eh={and:"AND",or:"OR"};class th{constructor(e,t){this.databaseId=e,this.wt=t}}function nh(e,t){return e.wt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function rh(e,t){return e.wt?t.toBase64():t.toUint8Array()}function ih(e,t){return nh(e,t.toTimestamp())}function sh(e){return Ba(!!e),ic.fromTimestamp(function(e){const t=Ac(e);return new rc(t.seconds,t.nanos)}(e))}function oh(e,t){return function(e){return new oc(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function ah(e){const t=oc.fromString(e);return Ba(kh(t)),t}function ch(e,t){return oh(e.databaseId,t.path)}function uh(e,t){const n=ah(t);if(n.get(1)!==e.databaseId.projectId)throw new $a(qa.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new $a(qa.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new uc(dh(n))}function lh(e,t){return oh(e.databaseId,t)}function hh(e){return new oc(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function dh(e){return Ba(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function fh(e,t,n){return{name:ch(e,t),fields:n.value.mapValue.fields}}function ph(e,t){return{documents:[lh(e,t.path)]}}function gh(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=lh(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=lh(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return Eh(tu.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:bh(e.field),direction:vh(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.wt||Ic(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function mh(e){let t=function(e){const t=ah(e);return 4===t.length?oc.emptyPath():dh(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Ba(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=yh(e);return t instanceof tu&&ru(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new gu(Th(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ic(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Xc(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Xc(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new Du(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function yh(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Th(e.unaryFilter.field);return eu.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Th(e.unaryFilter.field);return eu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Th(e.unaryFilter.field);return eu.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Th(e.unaryFilter.field);return eu.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Va()}}(e):void 0!==e.fieldFilter?function(e){return eu.create(Th(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Va()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return tu.create(e.compositeFilter.filters.map((e=>yh(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Va()}}(e.compositeFilter.op))}(e):Va()}function vh(e){return Yl[e]}function wh(e){return Zl[e]}function _h(e){return eh[e]}function bh(e){return{fieldPath:e.canonicalString()}}function Th(e){return cc.fromServerFormat(e.fieldPath)}function Eh(e){return e instanceof eu?function(e){if("=="===e.op){if(zc(e.value))return{unaryFilter:{field:bh(e.field),op:"IS_NAN"}};if(Hc(e.value))return{unaryFilter:{field:bh(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(zc(e.value))return{unaryFilter:{field:bh(e.field),op:"IS_NOT_NAN"}};if(Hc(e.value))return{unaryFilter:{field:bh(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bh(e.field),op:wh(e.op),value:e.value}}}(e):e instanceof tu?function(e){const t=e.getFilters().map((e=>Eh(e)));return 1===t.length?t[0]:{compositeFilter:{op:_h(e.op),filters:t}}}(e):Va()}function Ih(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function kh(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Sh{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&pl(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=gl(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=gl(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=xl();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=fl(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(ic.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Bl())}isEqual(e){return this.batchId===e.batchId&&nc(this.mutations,e.mutations,((e,t)=>yl(e,t)))&&nc(this.baseMutations,e.baseMutations,((e,t)=>yl(e,t)))}}class Ch{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Ba(e.mutations.length===n.length);let r=Fl;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Ch(e,t,n,r)}}class Ah{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Rh{constructor(e,t,n,r,i=ic.min(),s=ic.min(),o=Sc.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new Rh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Rh(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Rh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Nh{constructor(e){this.ie=e}}function Dh(e){const t=mh({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Bu(t,t.limit,"L"):t}class Oh{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(Rc(e.integerValue));else if("doubleValue"in e){const n=Rc(e.doubleValue);isNaN(n)?this.he(t,13):(this.he(t,15),kc(n)?t.le(0):t.le(n))}else if("timestampValue"in e){const n=e.timestampValue;this.he(t,20),"string"==typeof n?t.fe(n):(t.fe(`${n.seconds||""}`),t.le(n.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(Nc(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.he(t,45),t.le(n.latitude||0),t.le(n.longitude||0)}else"mapValue"in e?Qc(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):Va()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const n=e.fields||{};this.he(t,55);for(const e of Object.keys(n))this.de(e,t),this.ce(n[e],t)}ye(e,t){const n=e.values||[];this.he(t,50);for(const e of n)this.ce(e,t)}me(e,t){this.he(t,37),uc.fromName(e).path.forEach((e=>{this.he(t,60),this.pe(e,t)}))}he(e,t){e.le(t)}_e(e){e.le(2)}}Oh.Ie=new Oh;class Ph{constructor(){this.Je=new Lh}addToCollectionParentIndex(e,t){return this.Je.add(t),mc.resolve()}getCollectionParents(e,t){return mc.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return mc.resolve()}deleteFieldIndex(e,t){return mc.resolve()}getDocumentsMatchingTarget(e,t){return mc.resolve(null)}getIndexType(e,t){return mc.resolve(0)}getFieldIndexes(e,t){return mc.resolve([])}getNextCollectionGroupToUpdate(e){return mc.resolve(null)}getMinOffset(e,t){return mc.resolve(hc.min())}getMinOffsetFromCollectionGroup(e,t){return mc.resolve(hc.min())}updateCollectionGroup(e,t,n){return mc.resolve()}updateIndexEntries(e,t){return mc.resolve()}}class Lh{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new _u(oc.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new _u(oc.comparator)).toArray()}}new Uint8Array(0);class Mh{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Mh(e,Mh.DEFAULT_COLLECTION_PERCENTILE,Mh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Mh.DEFAULT_COLLECTION_PERCENTILE=10,Mh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mh.DEFAULT=new Mh(41943040,Mh.DEFAULT_COLLECTION_PERCENTILE,Mh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mh.DISABLED=new Mh(-1,0,0);class xh{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new xh(0)}static vn(){return new xh(-1)}}class Uh{constructor(){this.changes=new Rl((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ku.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?mc.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Fh{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Vh{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&gl(n.mutation,e,Tu.empty(),rc.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Bl()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Bl()){const r=Ml();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Pl();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Ml();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Bl())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Dl();const s=Ul(),o=Ul();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof wl)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),gl(o.mutation,t,o.mutation.getFieldMask(),rc.now())):s.set(t.key,Tu.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new Fh(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Ul();let r=new yu(((e,t)=>e-t)),i=Bl();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Tu.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||Bl()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=xl();c.forEach((e=>{if(!i.has(e)){const r=fl(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return mc.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return uc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):xu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):mc.resolve(Ml());let o=-1,a=i;return s.next((t=>mc.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?mc.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,Bl()))).next((e=>({batchId:o,changes:Ll(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new uc(t)).next((e=>{let t=Pl();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=Pl();return this.indexManager.getCollectionParents(e,r).next((s=>mc.forEach(s,(s=>{const o=function(e,t){return new Du(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,ku.newInvalidDocument(r)))}));let n=Pl();return e.forEach(((e,i)=>{const s=r.get(e);void 0!==s&&gl(s.mutation,i,Tu.empty(),rc.now()),Ku(t,i)&&(n=n.insert(e,i))})),n}))}}class Bh{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return mc.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var n;return this.Zn.set(t.id,{id:(n=t).id,version:n.version,createTime:sh(n.createTime)}),mc.resolve()}getNamedQuery(e,t){return mc.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,function(e){return{name:e.name,query:Dh(e.bundledQuery),readTime:sh(e.readTime)}}(t)),mc.resolve()}}class jh{constructor(){this.overlays=new yu(uc.comparator),this.es=new Map}getOverlay(e,t){return mc.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ml();return mc.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.oe(e,t,r)})),mc.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.es.delete(n)),mc.resolve()}getOverlaysForCollection(e,t,n){const r=Ml(),i=t.length+1,s=new uc(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return mc.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new yu(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Ml(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Ml(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return mc.resolve(o)}oe(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Ah(t,n));let i=this.es.get(t);void 0===i&&(i=Bl(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}class qh{constructor(){this.ns=new _u($h.ss),this.rs=new _u($h.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const n=new $h(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.cs(new $h(e,t))}hs(e,t){e.forEach((e=>this.removeReference(e,t)))}ls(e){const t=new uc(new oc([])),n=new $h(t,e),r=new $h(t,e+1),i=[];return this.rs.forEachInRange([n,r],(e=>{this.cs(e),i.push(e.key)})),i}fs(){this.ns.forEach((e=>this.cs(e)))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new uc(new oc([])),n=new $h(t,e),r=new $h(t,e+1);let i=Bl();return this.rs.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new $h(e,0),n=this.ns.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class $h{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return uc.comparator(e.key,t.key)||tc(e._s,t._s)}static os(e,t){return tc(e._s,t._s)||uc.comparator(e.key,t.key)}}class Kh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new _u($h.ss)}checkEmpty(e){return mc.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Sh(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.gs=this.gs.add(new $h(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return mc.resolve(s)}lookupMutationBatch(e,t){return mc.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ps(n),i=r<0?0:r;return mc.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return mc.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return mc.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new $h(t,0),r=new $h(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([n,r],(e=>{const t=this.ys(e._s);i.push(t)})),mc.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new _u(tc);return t.forEach((e=>{const t=new $h(e,0),r=new $h(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,r],(e=>{n=n.add(e._s)}))})),mc.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;uc.isDocumentKey(i)||(i=i.child(""));const s=new $h(new uc(i),0);let o=new _u(tc);return this.gs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e._s)),!0)}),s),mc.resolve(this.Is(o))}Is(e){const t=[];return e.forEach((e=>{const n=this.ys(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Ba(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let n=this.gs;return mc.forEach(t.mutations,(r=>{const i=new $h(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.gs=n}))}An(e){}containsKey(e,t){const n=new $h(t,0),r=this.gs.firstAfterOrEqual(n);return mc.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,mc.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Hh{constructor(e){this.Es=e,this.docs=new yu(uc.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return mc.resolve(n?n.document.mutableCopy():ku.newInvalidDocument(t))}getEntries(e,t){let n=Dl();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ku.newInvalidDocument(e))})),mc.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Dl();const s=t.path,o=new uc(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||dc(lc(o),n)<=0||(r.has(o.key)||Ku(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return mc.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Va()}As(e,t){return mc.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new zh(this)}getSize(e){return mc.resolve(this.size)}}class zh extends Uh{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(n)})),mc.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class Gh{constructor(e){this.persistence=e,this.Rs=new Rl((e=>Au(e)),Ru),this.lastRemoteSnapshotVersion=ic.min(),this.highestTargetId=0,this.bs=0,this.Ps=new qh,this.targetCount=0,this.vs=xh.Pn()}forEachTarget(e,t){return this.Rs.forEach(((e,n)=>t(n))),mc.resolve()}getLastRemoteSnapshotVersion(e){return mc.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return mc.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),mc.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),mc.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new xh(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,mc.resolve()}updateTargetData(e,t){return this.Dn(t),mc.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,mc.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Rs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Rs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),mc.waitFor(i).next((()=>r))}getTargetCount(e){return mc.resolve(this.targetCount)}getTargetData(e,t){const n=this.Rs.get(t)||null;return mc.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),mc.resolve()}removeMatchingKeys(e,t,n){this.Ps.hs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),mc.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),mc.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ps.ds(t);return mc.resolve(n)}containsKey(e,t){return mc.resolve(this.Ps.containsKey(t))}}class Wh{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new vc(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new Gh(this),this.indexManager=new Ph,this.remoteDocumentCache=function(e){return new Hh(e)}((e=>this.referenceDelegate.xs(e))),this.yt=new Nh(t),this.Ns=new Bh(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new jh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new Kh(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){Ma("MemoryPersistence","Starting transaction:",e);const r=new Qh(this.Ss.next());return this.referenceDelegate.ks(),n(r).next((e=>this.referenceDelegate.Os(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ms(e,t){return mc.or(Object.values(this.Vs).map((n=>()=>n.containsKey(e,t))))}}class Qh extends pc{constructor(e){super(),this.currentSequenceNumber=e}}class Xh{constructor(e){this.persistence=e,this.Fs=new qh,this.$s=null}static Bs(e){return new Xh(e)}get Ls(){if(this.$s)return this.$s;throw Va()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),mc.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),mc.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),mc.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach((e=>this.Ls.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ls.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return mc.forEach(this.Ls,(n=>{const r=uc.fromPath(n);return this.qs(e,r).next((e=>{e||t.removeEntry(r,ic.min())}))})).next((()=>(this.$s=null,t.apply(e))))}updateLimboDocument(e,t){return this.qs(e,t).next((e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())}))}xs(e){return 0}qs(e,t){return mc.or([()=>mc.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class Jh{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=Bl(),r=Bl();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Jh(e,t.fromCache,n,r)}}class Yh{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.ki(e,t).next((i=>i||this.Oi(e,t,r,n))).next((n=>n||this.Mi(e,t)))}ki(e,t){if(Pu(t))return mc.resolve(null);let n=Fu(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Bu(t,null,"F"),n=Fu(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=Bl(...r);return this.Ni.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Fi(t,r);return this.$i(t,s,i,n.readTime)?this.ki(e,Bu(t,null,"F")):this.Bi(e,s,t,n)}))))})))))}Oi(e,t,n,r){return Pu(t)||r.isEqual(ic.min())?this.Mi(e,t):this.Ni.getDocuments(e,n).next((i=>{const s=this.Fi(t,i);return this.$i(t,s,n,r)?this.Mi(e,t):(La()<=F.DEBUG&&Ma("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),$u(t)),this.Bi(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=ic.fromTimestamp(1e9===r?new rc(n+1,0):new rc(n,r));return new hc(i,uc.empty(),t)}(r,-1)))}))}Fi(e,t){let n=new _u(Hu(e));return t.forEach(((t,r)=>{Ku(e,r)&&(n=n.add(r))})),n}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Mi(e,t){return La()<=F.DEBUG&&Ma("QueryEngine","Using full collection scan to execute query:",$u(t)),this.Ni.getDocumentsMatchingQuery(e,t,hc.min())}Bi(e,t,n,r){return this.Ni.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Zh{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new yu(tc),this.Ui=new Rl((e=>Au(e)),Ru),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Vh(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.qi)))}}async function ed(e,t){const n=ja(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.Qi(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=Bl();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({ji:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function td(e){const t=ja(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Cs.getLastRemoteSnapshotVersion(e)))}function nd(e,t){const n=ja(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function rd(e,t,n){const r=ja(e),i=r.qi.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!yc(e))throw e;Ma("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.qi=r.qi.remove(t),r.Ui.delete(i.target)}function id(e,t,n){const r=ja(e);let i=ic.min(),s=Bl();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=ja(e),i=r.Ui.get(n);return void 0!==i?mc.resolve(r.qi.get(i)):r.Cs.getTargetData(t,n)}(r,e,Fu(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Li.getDocumentsMatchingQuery(e,t,n?i:ic.min(),n?s:Bl()))).next((e=>(function(e,t,n){let r=e.Ki.get(t)||ic.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Ki.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Hi:s})))))}class sd{constructor(){this.activeTargetIds=ql()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class od{constructor(){this.Lr=new sd,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new sd,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ad{Ur(e){}shutdown(){}}class cd{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){Ma("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){Ma("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const ud={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ld{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class hd extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,n,r,i){const s=this.ho(e,t);Ma("RestConnection","Sending: ",s,n);const o={};return this.lo(o,r,i),this.fo(e,s,o,n).then((e=>(Ma("RestConnection","Received: ",e),e)),(t=>{throw Ua("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}_o(e,t,n,r,i,s){return this.ao(e,t,n,r,i)}lo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Oa,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}ho(e,t){const n=ud[e];return`${this.oo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,n,r){return new Promise(((i,s)=>{const o=new Ra;o.setWithCredentials(!0),o.listenOnce(Ia.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Ea.NO_ERROR:const t=o.getResponseJson();Ma("Connection","XHR received:",JSON.stringify(t)),i(t);break;case Ea.TIMEOUT:Ma("Connection",'RPC "'+e+'" timed out'),s(new $a(qa.DEADLINE_EXCEEDED,"Request time out"));break;case Ea.HTTP_ERROR:const n=o.getStatus();if(Ma("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(qa).indexOf(t)>=0?t:qa.UNKNOWN}(t.status);s(new $a(e,t.message))}else s(new $a(qa.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new $a(qa.UNAVAILABLE,"Connection failed."));break;default:Va()}}finally{Ma("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(r);o.send(t,"POST",a,n,15)}))}wo(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=ba(),s=Ta(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Ca({})),this.lo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const a=r.join("");Ma("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let u=!1,l=!1;const h=new ld({Hr:e=>{l?Ma("Connection","Not sending because WebChannel is closed:",e):(u||(Ma("Connection","Opening WebChannel transport."),c.open(),u=!0),Ma("Connection","WebChannel sending:",e),c.send(e))},Jr:()=>c.close()}),d=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return d(c,Aa.EventType.OPEN,(()=>{l||Ma("Connection","WebChannel transport opened.")})),d(c,Aa.EventType.CLOSE,(()=>{l||(l=!0,Ma("Connection","WebChannel transport closed"),h.io())})),d(c,Aa.EventType.ERROR,(e=>{l||(l=!0,Ua("Connection","WebChannel transport errored:",e),h.io(new $a(qa.UNAVAILABLE,"The operation could not be completed")))})),d(c,Aa.EventType.MESSAGE,(e=>{var t;if(!l){const n=e.data[0];Ba(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){Ma("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=Sl[e];if(void 0!==t)return Al(t)}(e),n=i.message;void 0===t&&(t=qa.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),l=!0,h.io(new $a(t,n)),c.close()}else Ma("Connection","WebChannel received:",n),h.ro(n)}})),d(s,ka.STAT_EVENT,(e=>{e.stat===Sa.PROXY?Ma("Connection","Detected buffering proxy"):e.stat===Sa.NOPROXY&&Ma("Connection","Detected no buffering proxy")})),setTimeout((()=>{h.so()}),0),h}}function dd(){return"undefined"!=typeof document?document:null}function fd(e){return new th(e,!0)}class pd{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);r>0&&Ma("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,(()=>(this.Eo=Date.now(),e()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class gd{constructor(e,t,n,r,i,s,o,a){this.Hs=e,this.vo=n,this.Vo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new pd(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,(()=>this.$o())))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===qa.RESOURCE_EXHAUSTED?(xa(t.toString()),xa("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===qa.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.So===t&&this.Go(e,n)}),(t=>{e((()=>{const e=new $a(qa.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)}))}))}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr((()=>{n((()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,(()=>(this.ko()&&(this.state=3),Promise.resolve()))),this.listener.Yr())))})),this.stream.Zr((e=>{n((()=>this.Qo(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Oo(){this.state=5,this.xo.Ro((async()=>{this.state=0,this.start()}))}Qo(e){return Ma("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget((()=>this.So===e?t():(Ma("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class md extends gd{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.yt=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Va()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.wt?(Ba(void 0===t||"string"==typeof t),Sc.fromBase64String(t||"")):(Ba(void 0===t||t instanceof Uint8Array),Sc.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?qa.UNKNOWN:Al(e.code);return new $a(t,e.message||"")}(o);n=new Gl(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=uh(e,r.document.name),s=sh(r.document.updateTime),o=r.document.createTime?sh(r.document.createTime):ic.min(),a=new Eu({mapValue:{fields:r.document.fields}}),c=ku.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Hl(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=uh(e,r.document),s=r.readTime?sh(r.readTime):ic.min(),o=ku.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Hl([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=uh(e,r.document),s=r.removedTargetIds||[];n=new Hl([],s,i,null)}else{if(!("filter"in t))return Va();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new kl(r),s=e.targetId;n=new zl(s,i)}}return n}(this.yt,e),n=function(e){if(!("targetChange"in e))return ic.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ic.min():t.readTime?sh(t.readTime):ic.min()}(e);return this.listener.Wo(t,n)}zo(e){const t={};t.database=hh(this.yt),t.addTarget=function(e,t){let n;const r=t.target;return n=Nu(r)?{documents:ph(e,r)}:{query:gh(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=rh(e,t.resumeToken):t.snapshotVersion.compareTo(ic.min())>0&&(n.readTime=nh(e,t.snapshotVersion.toTimestamp())),n}(this.yt,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Va()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.yt,e);n&&(t.labels=n),this.Bo(t)}Ho(e){const t={};t.database=hh(this.yt),t.removeTarget=e,this.Bo(t)}}class yd extends gd{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.yt=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(Ba(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function(e,t){return e&&e.length>0?(Ba(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?sh(e.updateTime):sh(t);return n.isEqual(ic.min())&&(n=sh(t)),new ul(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=sh(e.commitTime);return this.listener.Zo(n,t)}return Ba(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=hh(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof vl)n={update:fh(e,t.key,t.value)};else if(t instanceof El)n={delete:ch(e,t.key)};else if(t instanceof wl)n={update:fh(e,t.key,t.data),updateMask:Ih(t.fieldMask)};else{if(!(t instanceof Il))return Va();n={verify:ch(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof el)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof tl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof rl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof sl)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw Va()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:ih(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Va()}(e,t.precondition)),n}(this.yt,e)))};this.Bo(t)}}class vd extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.yt=r,this.nu=!1}su(){if(this.nu)throw new $a(qa.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.ao(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===qa.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $a(qa.UNKNOWN,e.toString())}))}_o(e,t,n,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection._o(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===qa.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $a(qa.UNKNOWN,e.toString())}))}terminate(){this.nu=!0}}class wd{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(xa(t),this.ou=!1):Ma("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class _d{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.Ur((e=>{n.enqueueAndForget((async()=>{Rd(this)&&(Ma("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=ja(e);t._u.add(4),await Td(t),t.gu.set("Unknown"),t._u.delete(4),await bd(t)}(this))}))})),this.gu=new wd(n,r)}}async function bd(e){if(Rd(e))for(const t of e.wu)await t(!0)}async function Td(e){for(const t of e.wu)await t(!1)}function Ed(e,t){const n=ja(e);n.du.has(t.targetId)||(n.du.set(t.targetId,t),Ad(n)?Cd(n):zd(n).ko()&&kd(n,t))}function Id(e,t){const n=ja(e),r=zd(n);n.du.delete(t),r.ko()&&Sd(n,t),0===n.du.size&&(r.ko()?r.Fo():Rd(n)&&n.gu.set("Unknown"))}function kd(e,t){e.yu.Ot(t.targetId),zd(e).zo(t)}function Sd(e,t){e.yu.Ot(t),zd(e).Ho(t)}function Cd(e){e.yu=new Ql({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ne:t=>e.du.get(t)||null}),zd(e).start(),e.gu.uu()}function Ad(e){return Rd(e)&&!zd(e).No()&&e.du.size>0}function Rd(e){return 0===ja(e)._u.size}function Nd(e){e.yu=void 0}async function Dd(e){e.du.forEach(((t,n)=>{kd(e,t)}))}async function Od(e,t){Nd(e),Ad(e)?(e.gu.hu(t),Cd(e)):e.gu.set("Unknown")}async function Pd(e,t,n){if(e.gu.set("Online"),t instanceof Gl&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.du.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.du.delete(r),e.yu.removeTarget(r))}(e,t)}catch(n){Ma("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Ld(e,n)}else if(t instanceof Hl?e.yu.Kt(t):t instanceof zl?e.yu.Jt(t):e.yu.jt(t),!n.isEqual(ic.min()))try{const t=await td(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.yu.Zt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.du.get(r);i&&e.du.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.du.get(t);if(!n)return;e.du.set(t,n.withResumeToken(Sc.EMPTY_BYTE_STRING,n.snapshotVersion)),Sd(e,t);const r=new Rh(n.target,t,1,n.sequenceNumber);kd(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Ma("RemoteStore","Failed to raise snapshot:",t),await Ld(e,t)}}async function Ld(e,t,n){if(!yc(t))throw t;e._u.add(1),await Td(e),e.gu.set("Offline"),n||(n=()=>td(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Ma("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await bd(e)}))}function Md(e,t){return t().catch((n=>Ld(e,n,t)))}async function xd(e){const t=ja(e),n=Gd(t);let r=t.fu.length>0?t.fu[t.fu.length-1].batchId:-1;for(;Ud(t);)try{const e=await nd(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId,Fd(t,e)}catch(e){await Ld(t,e)}Vd(t)&&Bd(t)}function Ud(e){return Rd(e)&&e.fu.length<10}function Fd(e,t){e.fu.push(t);const n=Gd(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}function Vd(e){return Rd(e)&&!Gd(e).No()&&e.fu.length>0}function Bd(e){Gd(e).start()}async function jd(e){Gd(e).eu()}async function qd(e){const t=Gd(e);for(const n of e.fu)t.Xo(n.mutations)}async function $d(e,t,n){const r=e.fu.shift(),i=Ch.from(r,t,n);await Md(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await xd(e)}async function Kd(e,t){t&&Gd(e).Yo&&await async function(e,t){if(function(e){switch(e){default:return Va();case qa.CANCELLED:case qa.UNKNOWN:case qa.DEADLINE_EXCEEDED:case qa.RESOURCE_EXHAUSTED:case qa.INTERNAL:case qa.UNAVAILABLE:case qa.UNAUTHENTICATED:return!1;case qa.INVALID_ARGUMENT:case qa.NOT_FOUND:case qa.ALREADY_EXISTS:case qa.PERMISSION_DENIED:case qa.FAILED_PRECONDITION:case qa.ABORTED:case qa.OUT_OF_RANGE:case qa.UNIMPLEMENTED:case qa.DATA_LOSS:return!0}}(n=t.code)&&n!==qa.ABORTED){const n=e.fu.shift();Gd(e).Mo(),await Md(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await xd(e)}var n}(e,t),Vd(e)&&Bd(e)}async function Hd(e,t){const n=ja(e);n.asyncQueue.verifyOperationInProgress(),Ma("RemoteStore","RemoteStore received new credentials");const r=Rd(n);n._u.add(3),await Td(n),r&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await bd(n)}function zd(e){return e.pu||(e.pu=function(e,t,n){const r=ja(e);return r.su(),new md(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(e.datastore,e.asyncQueue,{Yr:Dd.bind(null,e),Zr:Od.bind(null,e),Wo:Pd.bind(null,e)}),e.wu.push((async t=>{t?(e.pu.Mo(),Ad(e)?Cd(e):e.gu.set("Unknown")):(await e.pu.stop(),Nd(e))}))),e.pu}function Gd(e){return e.Iu||(e.Iu=function(e,t,n){const r=ja(e);return r.su(),new yd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(e.datastore,e.asyncQueue,{Yr:jd.bind(null,e),Zr:Kd.bind(null,e),tu:qd.bind(null,e),Zo:$d.bind(null,e)}),e.wu.push((async t=>{t?(e.Iu.Mo(),await xd(e)):(await e.Iu.stop(),e.fu.length>0&&(Ma("RemoteStore",`Stopping write stream with ${e.fu.length} pending writes`),e.fu=[]))}))),e.Iu}class Wd{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ka,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Wd(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new $a(qa.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qd(e,t){if(xa("AsyncQueue",`${t}: ${e}`),yc(e))return new $a(qa.UNAVAILABLE,`${t}: ${e}`);throw e}class Xd{constructor(e){this.comparator=e?(t,n)=>e(t,n)||uc.comparator(t.key,n.key):(e,t)=>uc.comparator(e.key,t.key),this.keyedMap=Pl(),this.sortedSet=new yu(this.comparator)}static emptySet(e){return new Xd(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Xd))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Xd;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Jd{constructor(){this.Tu=new yu(uc.comparator)}track(e){const t=e.doc.key,n=this.Tu.get(t);n?0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):Va():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Yd{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Yd(e,t,Xd.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ju(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Zd{constructor(){this.Au=void 0,this.listeners=[]}}class ef{constructor(){this.queries=new Rl((e=>qu(e)),ju),this.onlineState="Unknown",this.Ru=new Set}}function tf(e,t){const n=ja(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Pu(e)&&(r=!0);i.Au=e}}r&&rf(n)}function nf(e,t,n){const r=ja(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function rf(e){e.Ru.forEach((e=>{e.next()}))}class sf{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Yd(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Nu||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(e.docChanges.length>0)return!0;const t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=Yd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class of{constructor(e){this.key=e}}class af{constructor(e){this.key=e}}class cf{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=Bl(),this.mutatedKeys=Bl(),this.Gu=Hu(e),this.Qu=new Xd(this.Gu)}get ju(){return this.qu}Wu(e,t){const n=t?t.zu:new Jd,r=t?t.Qu:this.Qu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Ku(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Hu(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Gu(l,a)>0||c&&this.Gu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Qu:s,zu:n,$i:o,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Eu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Va()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc))),this.Ju(n);const s=t?this.Yu():[],o=0===this.Ku.size&&this.current?1:0,a=o!==this.Uu;return this.Uu=o,0!==i.length||a?{snapshot:new Yd(this.query,e.Qu,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:s}:{Xu:s}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Jd,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach((e=>this.qu=this.qu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.qu=this.qu.delete(e))),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=Bl(),this.Qu.forEach((e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))}));const t=[];return e.forEach((e=>{this.Ku.has(e)||t.push(new af(e))})),this.Ku.forEach((n=>{e.has(n)||t.push(new of(n))})),t}tc(e){this.qu=e.Hi,this.Ku=Bl();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Yd.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class uf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class lf{constructor(e){this.key=e,this.nc=!1}}class hf{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.sc={},this.ic=new Rl((e=>qu(e)),ju),this.rc=new Map,this.oc=new Set,this.uc=new yu(uc.comparator),this.cc=new Map,this.ac=new qh,this.hc={},this.lc=new Map,this.fc=xh.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function df(e,t){const n=function(e){const t=ja(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=pf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Af.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=mf.bind(null,t),t.sc.Wo=tf.bind(null,t.eventManager),t.sc.wc=nf.bind(null,t.eventManager),t}(e);let r,i;const s=n.ic.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const e=await function(e,t){const n=ja(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Cs.getTargetData(e,t).next((i=>i?(r=i,mc.resolve(r)):n.Cs.allocateTargetId(e).next((i=>(r=new Rh(t,i,0,e.currentSequenceNumber),n.Cs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.qi.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qi=n.qi.insert(e.targetId,e),n.Ui.set(t,e.targetId)),e}))}(n.localStore,Fu(t));n.isPrimaryClient&&Ed(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await async function(e,t,n,r,i){e._c=(t,n,r)=>async function(e,t,n,r){let i=t.view.Wu(n);i.$i&&(i=await id(e.localStore,t.query,!1).then((({documents:e})=>t.view.Wu(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return Ef(e,t.targetId,o.Xu),o.snapshot}(e,t,n,r);const s=await id(e.localStore,t,!0),o=new cf(t,s.Hi),a=o.Wu(s.documents),c=Kl.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);Ef(e,n,u.Xu);const l=new uf(t,n,o);return e.ic.set(t,l),e.rc.has(n)?e.rc.get(n).push(t):e.rc.set(n,[t]),u.snapshot}(n,t,r,"current"===s,e.resumeToken)}return i}async function ff(e,t){const n=ja(e),r=n.ic.get(t),i=n.rc.get(r.targetId);if(i.length>1)return n.rc.set(r.targetId,i.filter((e=>!ju(e,t)))),void n.ic.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await rd(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Id(n.remoteStore,r.targetId),bf(n,r.targetId)})).catch(gc)):(bf(n,r.targetId),await rd(n.localStore,r.targetId,!0))}async function pf(e,t){const n=ja(e);try{const e=await function(e,t){const n=ja(e),r=t.snapshotVersion;let i=n.qi;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Gi.newChangeBuffer({trackRemovals:!0});i=n.qi;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Cs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Cs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(Sc.EMPTY_BYTE_STRING,ic.min()).withLastLimboFreeSnapshotVersion(ic.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Cs.updateTargetData(e,u))}));let a=Dl(),c=Bl();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=Bl(),i=Bl();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Dl();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ic.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Ma("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{Wi:r,zi:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.Wi,c=e.zi}))),!r.isEqual(ic.min())){const t=n.Cs.getLastRemoteSnapshotVersion(e).next((t=>n.Cs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return mc.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.qi=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.cc.get(t);r&&(Ba(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.nc=!0:e.modifiedDocuments.size>0?Ba(r.nc):e.removedDocuments.size>0&&(Ba(r.nc),r.nc=!1))})),await Sf(n,e,t)}catch(e){await gc(e)}}function gf(e,t,n){const r=ja(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ic.forEach(((n,r)=>{const i=r.view.bu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=ja(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.bu(t)&&(r=!0)})),r&&rf(n)}(r.eventManager,t),e.length&&r.sc.Wo(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function mf(e,t,n){const r=ja(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.cc.get(t),s=i&&i.key;if(s){let e=new yu(uc.comparator);e=e.insert(s,ku.newNoDocument(s,ic.min()));const n=Bl().add(s),i=new $l(ic.min(),new Map,new _u(tc),e,n);await pf(r,i),r.uc=r.uc.remove(s),r.cc.delete(t),kf(r)}else await rd(r.localStore,t,!1).then((()=>bf(r,t,n))).catch(gc)}async function yf(e,t){const n=ja(e),r=t.batch.batchId;try{const e=await function(e,t){const n=ja(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=mc.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Ba(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Bl();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);_f(n,r,null),wf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Sf(n,e)}catch(e){await gc(e)}}async function vf(e,t,n){const r=ja(e);try{const e=await function(e,t){const n=ja(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Ba(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);_f(r,t,n),wf(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Sf(r,e)}catch(n){await gc(n)}}function wf(e,t){(e.lc.get(t)||[]).forEach((e=>{e.resolve()})),e.lc.delete(t)}function _f(e,t,n){const r=ja(e);let i=r.hc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.hc[r.currentUser.toKey()]=i}}function bf(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.rc.get(t))e.ic.delete(r),n&&e.sc.wc(r,n);e.rc.delete(t),e.isPrimaryClient&&e.ac.ls(t).forEach((t=>{e.ac.containsKey(t)||Tf(e,t)}))}function Tf(e,t){e.oc.delete(t.path.canonicalString());const n=e.uc.get(t);null!==n&&(Id(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),kf(e))}function Ef(e,t,n){for(const r of n)r instanceof of?(e.ac.addReference(r.key,t),If(e,r)):r instanceof af?(Ma("SyncEngine","Document no longer in limbo: "+r.key),e.ac.removeReference(r.key,t),e.ac.containsKey(r.key)||Tf(e,r.key)):Va()}function If(e,t){const n=t.key,r=n.path.canonicalString();e.uc.get(n)||e.oc.has(r)||(Ma("SyncEngine","New document in limbo: "+n),e.oc.add(r),kf(e))}function kf(e){for(;e.oc.size>0&&e.uc.size<e.maxConcurrentLimboResolutions;){const t=e.oc.values().next().value;e.oc.delete(t);const n=new uc(oc.fromString(t)),r=e.fc.next();e.cc.set(r,new lf(n)),e.uc=e.uc.insert(n,r),Ed(e.remoteStore,new Rh(Fu(Ou(n.path)),r,2,vc.at))}}async function Sf(e,t,n){const r=ja(e),i=[],s=[],o=[];r.ic.isEmpty()||(r.ic.forEach(((e,a)=>{o.push(r._c(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Jh.Ci(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.sc.Wo(i),await async function(e,t){const n=ja(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>mc.forEach(t,(t=>mc.forEach(t.Si,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>mc.forEach(t.Di,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!yc(e))throw e;Ma("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.qi.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.qi=n.qi.insert(t,i)}}}(r.localStore,s))}async function Cf(e,t){const n=ja(e);if(!n.currentUser.isEqual(t)){Ma("SyncEngine","User change. New user:",t.toKey());const e=await ed(n.localStore,t);n.currentUser=t,function(e,t){e.lc.forEach((e=>{e.forEach((e=>{e.reject(new $a(qa.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.lc.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Sf(n,e.ji)}}function Af(e,t){const n=ja(e),r=n.cc.get(t);if(r&&r.nc)return Bl().add(r.key);{let e=Bl();const r=n.rc.get(t);if(!r)return e;for(const t of r){const r=n.ic.get(t);e=e.unionWith(r.view.ju)}return e}}function Rf(e){const t=ja(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=yf.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=vf.bind(null,t),t}class Nf{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=fd(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return function(e,t,n,r){return new Zh(e,t,n,r)}(this.persistence,new Yh,e.initialUser,this.yt)}yc(e){return new Wh(Xh.Bs,this.yt)}gc(e){return new od}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Df{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>gf(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Cf.bind(null,this.syncEngine),await async function(e,t){const n=ja(e);t?(n._u.delete(2),await bd(n)):t||(n._u.add(2),await Td(n),n.gu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ef}createDatastore(e){const t=fd(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new hd(r));var r;return function(e,t,n,r){return new vd(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>gf(this.syncEngine,e,0),s=cd.C()?new cd:new ad,new _d(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new hf(e,t,n,r,i,s);return o&&(a.dc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=ja(e);Ma("RemoteStore","RemoteStore shutting down."),t._u.add(5),await Td(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function Of(e,t,n){if(!n)throw new $a(qa.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Pf(e){if(!uc.isDocumentKey(e))throw new $a(qa.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Lf(e){if(uc.isDocumentKey(e))throw new $a(qa.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Mf(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Va()}function xf(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new $a(qa.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Mf(e);throw new $a(qa.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}const Uf=new Map;class Ff{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new $a(qa.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new $a(qa.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new $a(qa.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Vf{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ff({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new $a(qa.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new $a(qa.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ff(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new za;switch(e.type){case"gapi":const t=e.client;return new Xa(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new $a(qa.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Uf.get(e);t&&(Ma("ComponentProvider","Removing Datastore"),Uf.delete(e),t.terminate())}(this),Promise.resolve()}}class Bf{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Bf(this.firestore,e,this._key)}}class jf{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new jf(this.firestore,e,this._query)}}class qf extends jf{constructor(e,t,n){super(e,t,Ou(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Bf(this.firestore,null,new uc(e))}withConverter(e){return new qf(this.firestore,e,this._path)}}function $f(e,t,...n){if(e=O(e),Of("collection","path",t),e instanceof Vf){const r=oc.fromString(t,...n);return Lf(r),new qf(e,null,r)}{if(!(e instanceof Bf||e instanceof qf))throw new $a(qa.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(oc.fromString(t,...n));return Lf(r),new qf(e.firestore,null,r)}}function Kf(e,t,...n){if(e=O(e),1===arguments.length&&(t=ec.R()),Of("doc","path",t),e instanceof Vf){const r=oc.fromString(t,...n);return Pf(r),new Bf(e,null,new uc(r))}{if(!(e instanceof Bf||e instanceof qf))throw new $a(qa.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(oc.fromString(t,...n));return Pf(r),new Bf(e.firestore,e instanceof qf?e.converter:null,new uc(r))}}class Hf{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):xa("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class zf{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Da.UNAUTHENTICATED,this.clientId=ec.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Ma("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Ma("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new $a(qa.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ka;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Qd(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Gf(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){return e.offlineComponents||(Ma("FirestoreClient","Using default OfflineComponentProvider"),await async function(e,t){e.asyncQueue.verifyOperationInProgress(),Ma("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await ed(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}(e,new Nf)),e.offlineComponents}(e);Ma("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>Hd(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Hd(t.remoteStore,n))),e.onlineComponents=t}async function Wf(e){return e.onlineComponents||(Ma("FirestoreClient","Using default OnlineComponentProvider"),await Gf(e,new Df)),e.onlineComponents}async function Qf(e){const t=await Wf(e),n=t.eventManager;return n.onListen=df.bind(null,t.syncEngine),n.onUnlisten=ff.bind(null,t.syncEngine),n}class Xf{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new pd(this,"async_queue_retry"),this.Wc=()=>{const e=dd();e&&Ma("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=dd();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=dd();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise((()=>{}));const t=new Ka;return this.Hc((()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Lc.push(e),this.Jc())))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!yc(e))throw e;Ma("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro((()=>this.Jc()))}}Hc(e){const t=this.Bc.then((()=>(this.Gc=!0,e().catch((e=>{this.Kc=e,this.Gc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw xa("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Gc=!1,e))))));return this.Bc=t,t}enqueueAfterDelay(e,t,n){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=Wd.createAndSchedule(this,e,t,n,(e=>this.Yc(e)));return this.Uc.push(r),r}zc(){this.Kc&&Va()}verifyOperationInProgress(){}async Xc(){let e;do{e=this.Bc,await e}while(e!==this.Bc)}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then((()=>{this.Uc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()}))}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function Jf(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class Yf extends Vf{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Xf,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||tp(this),this._firestoreClient.terminate()}}function Zf(e,t){const n="string"==typeof e?e:t||"(default)",r=_e("object"==typeof e?e:ke(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=c("firestore");e&&function(e,t,n,r={}){var i;const s=(e=xf(e,Vf))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&Ua("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Da.MOCK_USER;else{t=d(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new $a(qa.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Da(s)}e._authCredentials=new Ga(new Ha(t,n))}}(r,...e)}return r}function ep(e){return e._firestoreClient||tp(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function tp(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new wc(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new zf(e._authCredentials,e._appCheckCredentials,e._queue,r)}class np{constructor(e){this._byteString=e}static fromBase64String(e){try{return new np(Sc.fromBase64String(e))}catch(e){throw new $a(qa.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new np(Sc.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class rp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new $a(qa.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new cc(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ip{constructor(e){this._methodName=e}}class sp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new $a(qa.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new $a(qa.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return tc(this._lat,e._lat)||tc(this._long,e._long)}}const op=/^__.*__$/;class ap{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new wl(e,this.data,this.fieldMask,t,this.fieldTransforms):new vl(e,this.data,t,this.fieldTransforms)}}class cp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new wl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function up(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Va()}}class lp{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.yt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new lp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Ep(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(up(this.sa)&&op.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class hp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=n||fd(e)}da(e,t,n,r=!1){return new lp({sa:e,methodName:t,fa:n,path:cc.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function dp(e){const t=e._freezeSettings(),n=fd(e._databaseId);return new hp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function fp(e,t,n,r,i,s={}){const o=e.da(s.merge||s.mergeFields?2:0,t,n,i);wp("Data must be an object, but it was:",o,r);const a=yp(r,o);let c,u;if(s.merge)c=new Tu(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=_p(t,r,n);if(!o.contains(i))throw new $a(qa.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ip(e,i)||e.push(i)}c=new Tu(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new ap(new Eu(a),c,u)}class pp extends ip{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof pp}}class gp extends ip{_toFieldTransform(e){return new cl(e.path,new el)}isEqual(e){return e instanceof gp}}function mp(e,t){if(vp(e=O(e)))return wp("Unsupported field value:",t,e),yp(e,t);if(e instanceof ip)return function(e,t){if(!up(t.sa))throw t.ha(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ha(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.oa&&4!==t.sa)throw t.ha("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=mp(i,t.aa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=O(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Qu(t.yt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=rc.fromDate(e);return{timestampValue:nh(t.yt,n)}}if(e instanceof rc){const n=new rc(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:nh(t.yt,n)}}if(e instanceof sp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof np)return{bytesValue:rh(t.yt,e._byteString)};if(e instanceof Bf){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:oh(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ha(`Unsupported field value: ${Mf(e)}`)}(e,t)}function yp(e,t){const n={};return Ec(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Tc(e,((e,r)=>{const i=mp(r,t.ra(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function vp(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof rc||e instanceof sp||e instanceof np||e instanceof Bf||e instanceof ip)}function wp(e,t,n){if(!vp(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Mf(n);throw"an object"===r?t.ha(e+" a custom object"):t.ha(e+" "+r)}}function _p(e,t,n){if((t=O(t))instanceof rp)return t._internalPath;if("string"==typeof t)return Tp(e,t);throw Ep("Field path arguments must be of type string or ",e,!1,void 0,n)}const bp=new RegExp("[~\\*/\\[\\]]");function Tp(e,t,n){if(t.search(bp)>=0)throw Ep(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new rp(...t.split("."))._internalPath}catch(r){throw Ep(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Ep(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new $a(qa.INVALID_ARGUMENT,a+e+c)}function Ip(e,t){return e.some((e=>e.isEqual(t)))}class kp{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Bf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Sp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Cp("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Sp extends kp{data(){return super.data()}}function Cp(e,t){return"string"==typeof t?Tp(e,t):t instanceof rp?t._internalPath:t._delegate._internalPath}class Ap{}class Rp extends Ap{}class Np extends Rp{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Np(e,t,n)}_apply(e){const t=this._parse(e);return xp(e._query,t),new jf(e.firestore,e.converter,Vu(e._query,t))}_parse(e){const t=dp(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new $a(qa.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Mp(o,s);const t=[];for(const n of o)t.push(Lp(r,e,n));a={arrayValue:{values:t}}}else a=Lp(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Mp(o,s),a=function(e,t,n,r=!1){return mp(n,e.da(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);return eu.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class Dp extends Ap{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Dp(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:tu.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)xp(n,e),n=Vu(n,e)}(e._query,t),new jf(e.firestore,e.converter,Vu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Op extends Rp{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Op(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new $a(qa.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new $a(qa.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new gu(t,n);return function(e,t){if(null===Lu(e)){const n=Mu(e);null!==n&&Up(0,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new jf(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Du(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class Pp extends Rp{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Pp(e,t,n)}_apply(e){return new jf(e.firestore,e.converter,Bu(e._query,this._limit,this._limitType))}}function Lp(e,t,n){if("string"==typeof(n=O(n))){if(""===n)throw new $a(qa.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xu(t)&&-1!==n.indexOf("/"))throw new $a(qa.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(oc.fromString(n));if(!uc.isDocumentKey(r))throw new $a(qa.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return qc(e,new uc(r))}if(n instanceof Bf)return qc(e,n._key);throw new $a(qa.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Mf(n)}.`)}function Mp(e,t){if(!Array.isArray(e)||0===e.length)throw new $a(qa.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new $a(qa.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function xp(e,t){if(t.isInequality()){const n=Mu(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new $a(qa.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=Lu(e);null!==i&&Up(0,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new $a(qa.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new $a(qa.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function Up(e,t,n){if(!n.isEqual(t))throw new $a(qa.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Fp{convertValue(e,t="none"){switch(Mc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Rc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Nc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Va()}}convertObject(e,t){const n={};return Tc(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new sp(Rc(e.latitude),Rc(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Oc(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Pc(e));default:return null}}convertTimestamp(e){const t=Ac(e);return new rc(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=oc.fromString(e);Ba(kh(n));const r=new _c(n.get(1),n.get(3)),i=new uc(n.popFirst(5));return r.isEqual(t)||xa(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Vp(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Bp{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jp extends kp{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new qp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Cp("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class qp extends jp{data(e={}){return super.data(e)}}class $p{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Bp(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new qp(this._firestore,this._userDataWriter,n.key,n,new Bp(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new $a(qa.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new qp(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Bp(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new qp(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Bp(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Kp(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Kp(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Va()}}class Hp extends Fp{constructor(e){super(),this.firestore=e}convertBytes(e){return new np(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Bf(this.firestore,null,t)}}function zp(e,t){const n=xf(e.firestore,Yf),r=Kf(e),i=Vp(e.converter,t);return Gp(n,[fp(dp(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,ll.exists(!1))]).then((()=>r))}function Gp(e,t){return function(e,t){const n=new Ka;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Rf(e);try{const e=await function(e,t){const n=ja(e),r=rc.now(),i=t.reduce(((e,t)=>e.add(t.key)),Bl());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Dl(),c=Bl();return n.Gi.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=ml(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new wl(e.key,t,Iu(t.value.mapValue),ll.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Ll(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.hc[e.currentUser.toKey()];r||(r=new yu(tc)),r=r.insert(t,n),e.hc[e.currentUser.toKey()]=r}(r,e.batchId,n),await Sf(r,e.changes),await xd(r.remoteStore)}catch(e){const t=Qd(e,"Failed to persist write");n.reject(t)}}(await function(e){return Wf(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(ep(e),t)}function Wp(){return new gp("serverTimestamp")}!function(e,t=!0){!function(e){Oa=e}(Ee),we(new P("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Yf(new Wa(e.getProvider("auth-internal")),new Ya(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new $a(qa.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _c(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Se(Na,"3.8.3",e),Se(Na,"3.8.3","esm2017")}();const Qp="firebasestorage.googleapis.com",Xp="storageBucket";class Jp extends y{constructor(e,t,n=0){super(eg(e),`Firebase Storage: ${t} (${eg(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Jp.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return eg(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Yp,Zp;function eg(e){return"storage/"+e}function tg(){return new Jp(Yp.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function ng(){return new Jp(Yp.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function rg(){return new Jp(Yp.CANCELED,"User canceled the upload/download.")}function ig(){return new Jp(Yp.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function sg(e){return new Jp(Yp.INVALID_ARGUMENT,e)}function og(){return new Jp(Yp.APP_DELETED,"The Firebase app was deleted.")}function ag(e,t){return new Jp(Yp.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function cg(e){throw new Jp(Yp.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Yp||(Yp={}));class ug{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=ug.makeFromUrl(e,t)}catch(t){return new ug(e,"")}if(""===n.path)return n;throw r=e,new Jp(Yp.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Qp?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<a.length;t++){const r=a[t],i=r.regex.exec(e);if(i){const e=i[r.indices.bucket];let t=i[r.indices.path];t||(t=""),n=new ug(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new Jp(Yp.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class lg{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function hg(e){return"string"==typeof e||e instanceof String}function dg(e){return fg()&&e instanceof Blob}function fg(){return"undefined"!=typeof Blob&&!function(){var t;const n=null===(t=o())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()}function pg(e,t,n,r){if(r<t)throw sg(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw sg(`Invalid value for '${e}'. Expected ${n} or less.`)}function gg(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function mg(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}function yg(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Zp||(Zp={}));class vg{constructor(e,t,n,r,i,s,o,a,c,u,l,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(e){r(e)}else if(null!==i){const e=tg();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else t.canceled?r(this.appDelete_?og():rg()):r(ng())};this.canceled_?e(0,new wg(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function l(...e){u||(u=!0,t.apply(null,e))}function h(t){i=setTimeout((()=>{i=null,e(f,c())}),t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(u)return void d();if(e)return d(),void l.call(null,e,...t);if(c()||o)return d(),void l.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function g(e){p||(p=!0,d(),u||(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout((()=>{o=!0,g(!0)}),n),g}(((e,t)=>{if(t)return void e(!1,new wg(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Zp.NO_ERROR,i=n.getStatus();if(!t||yg(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Zp.ABORT;return void e(!1,new wg(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new wg(s,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class wg{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function _g(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function bg(...e){const t=_g();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(fg())return new Blob(e);throw new Jp(Yp.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const Tg={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Eg{constructor(e,t){this.data=e,this.contentType=t||null}}function Ig(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function kg(e,t){switch(e){case Tg.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw ag(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case Tg.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw ag(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(e){if("undefined"==typeof atob)throw new Jp(Yp.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw ag(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class Sg{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw ag(Tg.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;var r,i;null!=n&&(this.base64=(i=";base64",(r=n).length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1)}}class Cg{constructor(e,t){let n=0,r="";dg(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(dg(this.data_)){const s=(n=this.data_,r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new Cg(s)}var n,r,i;{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Cg(n,!0)}}static getBlob(...e){if(fg()){const t=e.map((e=>e instanceof Cg?e.data_:e));return new Cg(bg.apply(null,t))}{const t=e.map((e=>hg(e)?function(e,t){switch(e){case Tg.RAW:return new Eg(Ig(t));case Tg.BASE64:case Tg.BASE64URL:return new Eg(kg(e,t));case Tg.DATA_URL:return new Eg(function(e){const t=new Sg(e);return t.base64?kg(Tg.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw ag(Tg.DATA_URL,"Malformed data URL.")}return Ig(t)}(t.rest)}(t),new Sg(t).contentType)}throw tg()}(Tg.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let i=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]})),new Cg(r,!0)}}uploadData(){return this.data_}}function Ag(e){let t;try{t=JSON.parse(e)}catch(e){return null}return function(e){return"object"==typeof e&&!Array.isArray(e)}(t)?t:null}function Rg(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Ng(e,t){return t}class Dg{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Ng}}let Og=null;function Pg(){if(Og)return Og;const e=[];e.push(new Dg("bucket")),e.push(new Dg("generation")),e.push(new Dg("metageneration")),e.push(new Dg("name","fullPath",!0));const t=new Dg("name");t.xform=function(e,t){return function(e){return!hg(e)||e.length<2?e:Rg(e)}(t)},e.push(t);const n=new Dg("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Dg("timeCreated")),e.push(new Dg("updated")),e.push(new Dg("md5Hash",null,!0)),e.push(new Dg("cacheControl",null,!0)),e.push(new Dg("contentDisposition",null,!0)),e.push(new Dg("contentEncoding",null,!0)),e.push(new Dg("contentLanguage",null,!0)),e.push(new Dg("contentType",null,!0)),e.push(new Dg("metadata","customMetadata",!0)),Og=e,Og}function Lg(e,t,n){const r=Ag(t);return null===r?null:function(e,t,n){const r={type:"file"},i=n.length;for(let e=0;e<i;e++){const i=n[e];r[i.local]=i.xform(r,t[i.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new ug(n,r);return t._makeStorageReference(i)}})}(r,e),r}(e,r,n)}function Mg(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}class xg{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Ug(e){if(!e)throw tg()}function Fg(e,t){return function(n,r){const i=Lg(e,r,t);return Ug(null!==i),i}}function Vg(e){return function(t,n){let r;var i,s;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new Jp(Yp.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Jp(Yp.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new Jp(Yp.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new Jp(Yp.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function Bg(e){const t=Vg(e);return function(n,r){let i=t(n,r);var s;return 404===n.getStatus()&&(s=e.path,i=new Jp(Yp.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function jg(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),r}class qg{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function $g(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){Ug(!1)}return Ug(!!n&&-1!==(t||["active"]).indexOf(n)),n}const Kg=262144;const Hg={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function zg(e){switch(e){case"running":case"pausing":case"canceling":return Hg.RUNNING;case"paused":return Hg.PAUSED;case"success":return Hg.SUCCESS;case"canceled":return Hg.CANCELED;default:return Hg.ERROR}}class Gg{constructor(e,t,n){const r=function(e){return"function"==typeof e}(e)||null!=t||null!=n;if(r)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function Wg(e){return(...t)=>{Promise.resolve().then((()=>e(...t)))}}let Qg=null;class Xg{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Zp.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Zp.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Zp.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw cg("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const e in r)r.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,r[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw cg("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw cg("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw cg("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw cg("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Jg extends Xg{initXhr(){this.xhr_.responseType="text"}}function Yg(){return Qg?Qg():new Jg}class Zg{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=Pg(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(Yp.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(yg(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=ng()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(Yp.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout((()=>{this.pendingTimeout=void 0,this._continueUpload()}),this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o=jg(t,r,i),a={name:o.fullPath},c=gg(s,e.host,e._protocol),u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},l=Mg(o,n),h=e.maxUploadRetryTime,d=new xg(c,"POST",(function(e){let t;$g(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){Ug(!1)}return Ug(hg(t)),t}),h);return d.urlParams=a,d.headers=u,d.body=l,d.errorHandler=Vg(t),d}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Yg,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const r=function(e,t,n,r){const i=e.maxUploadRetryTime,s=new xg(n,"POST",(function(e){const t=$g(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){Ug(!1)}n||Ug(!1);const i=Number(n);return Ug(!isNaN(i)),new qg(i,r.size(),"final"===t)}),i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=Vg(t),s}(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(r,Yg,t,n);this._request=i,i.getPromise().then((e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=Kg*this._chunkMultiplier,t=new qg(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,i)=>{let s;try{s=function(e,t,n,r,i,s,o,a){const c=new qg(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new Jp(Yp.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");const u=c.total-c.current;let l=u;i>0&&(l=Math.min(l,i));const h=c.current,d=h+l;let f="";f=0===l?"finalize":u===l?"upload, finalize":"upload";const p={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${c.current}`},g=r.slice(h,d);if(null===g)throw ig();const m=t.maxUploadRetryTime,y=new xg(n,"POST",(function(e,n){const i=$g(e,["active","final"]),o=c.current+l,a=r.size();let u;return u="final"===i?Fg(t,s)(e,n):null,new qg(o,a,"final"===i,u)}),m);return y.headers=p,y.body=g.uploadData(),y.progressCallback=a||null,y.errorHandler=Vg(e),y}(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const o=this._ref.storage._makeRequest(s,Yg,r,i,!1);this._request=o,o.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){Kg*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=function(e,t,n){const r=gg(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new xg(r,"GET",Fg(e,n),i);return s.errorHandler=Bg(t),s}(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,Yg,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=jg(t,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Mg(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",l="\r\n--"+a+"--",h=Cg.getBlob(u,r,l);if(null===h)throw ig();const d={name:c.fullPath},f=gg(s,e.host,e._protocol),p=e.maxUploadRetryTime,g=new xg(f,"POST",Fg(e,n),p);return g.urlParams=d,g.headers=o,g.body=h.uploadData(),g.errorHandler=Vg(t),g}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Yg,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=rg(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=zg(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new Gg(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(zg(this._state)){case Hg.SUCCESS:Wg(this._resolve.bind(null,this.snapshot))();break;case Hg.CANCELED:case Hg.ERROR:Wg(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(zg(this._state)){case Hg.RUNNING:case Hg.PAUSED:e.next&&Wg(e.next.bind(e,this.snapshot))();break;case Hg.SUCCESS:e.complete&&Wg(e.complete.bind(e))();break;case Hg.CANCELED:case Hg.ERROR:default:e.error&&Wg(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class em{constructor(e,t){this._service=e,this._location=t instanceof ug?t:ug.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new em(e,t)}get root(){const e=new ug(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Rg(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new ug(this._location.bucket,e);return new em(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Jp(Yp.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function tm(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=gg(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new xg(r,"GET",function(e,t){return function(n,r){const i=Lg(e,r,t);return Ug(null!==i),function(e,t,n,r){const i=Ag(t);if(null===i)return null;if(!hg(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((t=>{const i=e.bucket,s=e.fullPath;return gg("/b/"+o(i)+"/o/"+o(s),n,r)+mg({alt:"media",token:t})}))[0]}(i,r,e.host,e._protocol)}}(e,n),i);return s.errorHandler=Bg(t),s}(e.storage,e._location,Pg());return e.storage.makeRequestWithTokens(t,Yg).then((e=>{if(null===e)throw new Jp(Yp.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function nm(e,t){if(e instanceof im){const n=e;if(null==n._bucket)throw new Jp(Yp.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Xp+"' property when initializing the app?");const r=new em(n,n._bucket);return null!=t?nm(r,t):r}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new ug(e._location.bucket,n);return new em(e.storage,r)}(e,t):e}function rm(e,t){const n=null==t?void 0:t[Xp];return null==n?null:ug.makeFromBucketSpec(n,e)}class im{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=Qp,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?ug.makeFromBucketSpec(r,this._host):rm(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=ug.makeFromBucketSpec(this._url,e):this._bucket=rm(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){pg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){pg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new em(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new lg(og());{const s=function(e,t,n,r,i,s,o=!0){const a=mg(e.urlParams),c=e.url+a,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(u,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,r),new vg(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const sm="@firebase/storage",om="0.11.1",am="storage";we(new P(am,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new im(n,r,i,t,Ee)}),"PUBLIC").setMultipleInstances(!0)),Se(sm,om,""),Se(sm,om,"esm2017");const cm="@firebase/installations",um="0.6.3",lm=1e4,hm=`w:${um}`,dm="FIS_v2",fm="https://firebaseinstallations.googleapis.com/v1",pm=36e5,gm=new v("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function mm(e){return e instanceof y&&e.code.includes("request-failed")}function ym({projectId:e}){return`${fm}/projects/${e}/installations`}function vm(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function wm(e,t){const n=(await t.json()).error;return gm.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function _m({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function bm(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Tm(e){return new Promise((t=>{setTimeout(t,e)}))}const Em=/^[cdef][\w-]{21}$/,Im="";function km(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return Em.test(t)?t:Im}catch(e){return Im}}function Sm(e){return`${e.appName}!${e.appId}`}const Cm=new Map;function Am(e,t){const n=Sm(e);Rm(n,t),function(e,t){const n=(!Nm&&"BroadcastChannel"in self&&(Nm=new BroadcastChannel("[Firebase] FID Change"),Nm.onmessage=e=>{Rm(e.data.key,e.data.fid)}),Nm);n&&n.postMessage({key:e,fid:t}),0===Cm.size&&Nm&&(Nm.close(),Nm=null)}(n,t)}function Rm(e,t){const n=Cm.get(e);if(n)for(const e of n)e(t)}let Nm=null;const Dm="firebase-installations-database",Om=1,Pm="firebase-installations-store";let Lm=null;function Mm(){return Lm||(Lm=re(Dm,Om,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Pm)}})),Lm}async function xm(e,t){const n=Sm(e),r=(await Mm()).transaction(Pm,"readwrite"),i=r.objectStore(Pm),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||Am(e,t.fid),t}async function Um(e){const t=Sm(e),n=(await Mm()).transaction(Pm,"readwrite");await n.objectStore(Pm).delete(t),await n.done}async function Fm(e,t){const n=Sm(e),r=(await Mm()).transaction(Pm,"readwrite"),i=r.objectStore(Pm),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||Am(e,o.fid),o}async function Vm(e){let t;const n=await Fm(e.appConfig,(n=>{const r=function(e){return qm(e||{fid:km(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(gm.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=ym(e),i=_m(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:dm,appId:e.appId,sdkVersion:hm},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await bm((()=>fetch(r,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:vm(e.authToken)}}throw await wm("Create Installation",c)}(e,t);return xm(e.appConfig,n)}catch(n){throw mm(n)&&409===n.customData.serverCode?await Um(e.appConfig):await xm(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Bm(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return n.fid===Im?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Bm(e){let t=await jm(e.appConfig);for(;1===t.registrationStatus;)await Tm(100),t=await jm(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await Vm(e);return n||t}return t}function jm(e){return Fm(e,(e=>{if(!e)throw gm.create("installation-not-found");return qm(e)}))}function qm(e){return 1===(t=e).registrationStatus&&t.registrationTime+lm<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function $m({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${ym(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=_m(e);return n.append("Authorization",function(e){return`${dm} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:hm,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await bm((()=>fetch(r,a)));if(c.ok)return vm(await c.json());throw await wm("Generate Auth Token",c)}async function Km(e,t=!1){let n;const r=await Fm(e.appConfig,(r=>{if(!zm(r))throw gm.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+pm}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await Hm(e.appConfig);for(;1===n.authToken.requestStatus;)await Tm(100),n=await Hm(e.appConfig);const r=n.authToken;return 0===r.requestStatus?Km(e,t):r}(e,t),r;{if(!navigator.onLine)throw gm.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await $m(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await xm(e.appConfig,r),n}catch(n){if(!mm(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await xm(e.appConfig,n)}else await Um(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function Hm(e){return Fm(e,(e=>{if(!zm(e))throw gm.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+lm<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function zm(e){return void 0!==e&&2===e.registrationStatus}function Gm(e){return gm.create("missing-app-config-values",{valueName:e})}const Wm="installations";we(new P(Wm,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Gm("App Configuration");if(!e.name)throw Gm("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Gm(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:_e(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),we(new P("installations-internal",(e=>{const t=_e(e.getProvider("app").getImmediate(),Wm).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await Vm(t);return r?r.catch(console.error):Km(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await Vm(e);t&&await t}(n),(await Km(n,t)).token}(t,e)}}),"PRIVATE")),Se(cm,um),Se(cm,um,"esm2017");const Qm="/firebase-messaging-sw.js",Xm="/firebase-cloud-messaging-push-scope",Jm="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Ym="https://fcmregistrations.googleapis.com/v1",Zm="google.c.a.c_id",ey="google.c.a.c_l",ty="google.c.a.ts",ny="google.c.a.e";var ry,iy;function sy(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function oy(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;++e)r[e]=n.charCodeAt(e);return r}!function(e){e[e.DATA_MESSAGE=1]="DATA_MESSAGE",e[e.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"}(ry||(ry={})),function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(iy||(iy={}));const ay="fcm_token_details_db",cy=5,uy="fcm_token_object_Store",ly="firebase-messaging-database",hy=1,dy="firebase-messaging-store";let fy=null;function py(){return fy||(fy=re(ly,hy,{upgrade:(e,t)=>{0===t&&e.createObjectStore(dy)}})),fy}async function gy(e){const t=yy(e),n=await py(),r=await n.transaction(dy).objectStore(dy).get(t);if(r)return r;{const t=await async function(e){if("databases"in indexedDB){const e=(await indexedDB.databases()).map((e=>e.name));if(!e.includes(ay))return null}let t=null;const n=await re(ay,cy,{upgrade:async(n,r,i,s)=>{var o;if(r<2)return;if(!n.objectStoreNames.contains(uy))return;const a=s.objectStore(uy),c=await a.index("fcmSenderId").get(e);if(await a.clear(),c)if(2===r){const e=c;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(o=e.createTime)&&void 0!==o?o:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:sy(e.vapidKey)}}}else if(3===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:sy(e.auth),p256dh:sy(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:sy(e.vapidKey)}}}else if(4===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:sy(e.auth),p256dh:sy(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:sy(e.vapidKey)}}}}});return n.close(),await ie(ay),await ie("fcm_vapid_details_db"),await ie("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}(t)?t:null}(e.appConfig.senderId);if(t)return await my(e,t),t}}async function my(e,t){const n=yy(e),r=(await py()).transaction(dy,"readwrite");return await r.objectStore(dy).put(t,n),await r.done,t}function yy({appConfig:e}){return e.appId}const vy=new v("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function wy(e,t){const n={method:"DELETE",headers:await by(e)};try{const r=await fetch(`${_y(e.appConfig)}/${t}`,n),i=await r.json();if(i.error){const e=i.error.message;throw vy.create("token-unsubscribe-failed",{errorInfo:e})}}catch(e){throw vy.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function _y({projectId:e}){return`${Ym}/projects/${e}/registrations`}async function by({appConfig:e,installations:t}){const n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function Ty({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==Jm&&(i.web.applicationPubKey=r),i}const Ey=6048e5;async function Iy(e){const t=await async function(e,t){const n=await e.pushManager.getSubscription();return n||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:oy(t)})}(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:sy(t.getKey("auth")),p256dh:sy(t.getKey("p256dh"))},r=await gy(e.firebaseDependencies);if(r){if(function(e,t){const n=t.vapidKey===e.vapidKey,r=t.endpoint===e.endpoint,i=t.auth===e.auth,s=t.p256dh===e.p256dh;return n&&r&&i&&s}(r.subscriptionOptions,n))return Date.now()>=r.createTime+Ey?async function(e,t){try{const n=await async function(e,t){const n=await by(e),r=Ty(t.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)};let s;try{const n=await fetch(`${_y(e.appConfig)}/${t.token}`,i);s=await n.json()}catch(e){throw vy.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(s.error){const e=s.error.message;throw vy.create("token-update-failed",{errorInfo:e})}if(!s.token)throw vy.create("token-update-no-token");return s.token}(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await my(e.firebaseDependencies,r),n}catch(t){throw await async function(e){const t=await gy(e.firebaseDependencies);t&&(await wy(e.firebaseDependencies,t.token),await async function(e){const t=yy(e),n=(await py()).transaction(dy,"readwrite");await n.objectStore(dy).delete(t),await n.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}(e),t}}(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{await wy(e.firebaseDependencies,r.token)}catch(e){console.warn(e)}return ky(e.firebaseDependencies,n)}return ky(e.firebaseDependencies,n)}async function ky(e,t){const n=await async function(e,t){const n=await by(e),r=Ty(t),i={method:"POST",headers:n,body:JSON.stringify(r)};let s;try{const t=await fetch(_y(e.appConfig),i);s=await t.json()}catch(e){throw vy.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(s.error){const e=s.error.message;throw vy.create("token-subscribe-failed",{errorInfo:e})}if(!s.token)throw vy.create("token-subscribe-no-token");return s.token}(e,t),r={token:n,createTime:Date.now(),subscriptionOptions:t};return await my(e,r),r.token}function Sy(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i);const s=t.notification.icon;s&&(e.notification.icon=s)}(t,e),function(e,t){t.data&&(e.data=t.data)}(t,e),function(e,t){var n,r,i,s,o;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};const a=null!==(i=null===(r=t.fcmOptions)||void 0===r?void 0:r.link)&&void 0!==i?i:null===(s=t.notification)||void 0===s?void 0:s.click_action;a&&(e.fcmOptions.link=a);const c=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;c&&(e.fcmOptions.analyticsLabel=c)}(t,e),t}function Cy(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function Ay(e){return vy.create("missing-app-config-values",{valueName:e})}Cy("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),Cy("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class Ry{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(e){if(!e||!e.options)throw Ay("App Configuration Object");if(!e.name)throw Ay("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const e of t)if(!n[e])throw Ay(e);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function Ny(e,t){if(!navigator)throw vy.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw vy.create("permission-blocked");return await async function(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=Jm)}(e,null==t?void 0:t.vapidKey),await async function(e,t){if(t||e.swRegistration||await async function(e){try{e.swRegistration=await navigator.serviceWorker.register(Qm,{scope:Xm}),e.swRegistration.update().catch((()=>{}))}catch(e){throw vy.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw vy.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),Iy(e)}async function Dy(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===iy.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(Sy(n)):e.onMessageHandler.next(Sy(n)));const r=n.data;var i;"object"==typeof(i=r)&&i&&Zm in i&&"1"===r[ny]&&await async function(e,t,n){const r=function(e){switch(e){case iy.NOTIFICATION_CLICKED:return"notification_open";case iy.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[Zm],message_name:n[ey],message_time:n[ty],message_device_time:Math.floor(Date.now()/1e3)})}(e,n.messageType,r)}const Oy="@firebase/messaging",Py="0.12.3";function Ly(e=ke()){return async function(){try{await g()}catch(e){return!1}return"undefined"!=typeof window&&p()&&m()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}().then((e=>{if(!e)throw vy.create("unsupported-browser")}),(e=>{throw vy.create("indexed-db-unsupported")})),_e(O(e),"messaging").getImmediate()}we(new P("messaging",(e=>{const t=new Ry(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",(e=>Dy(t,e))),t}),"PUBLIC")),we(new P("messaging-internal",(e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>Ny(t,e)}}),"PRIVATE")),Se(Oy,Py),Se(Oy,Py,"esm2017");const My="@firebase/performance",xy="0.6.3",Uy=xy,Fy="FB-PERF-TRACE-MEASURE",Vy="_wt_",By="_fcp",jy="_fid",qy="@firebase/performance/config",$y="@firebase/performance/configexpire",Ky="Performance",Hy=new v("performance",Ky,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),zy=new K(Ky);let Gy,Wy,Qy,Xy;zy.logLevel=F.INFO;class Jy{constructor(e){if(this.window=e,!e)throw Hy.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&m()?!!p()||(zy.info("IndexedDB is not supported by current browswer"),!1):(zy.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver((e=>{for(const n of e.getEntries())t(n)})).observe({entryTypes:[e]})}static getInstance(){return void 0===Gy&&(Gy=new Jy(Wy)),Gy}}function Yy(){return Qy}function Zy(e,t){const n=e.length-t.length;if(n<0||n>1)throw Hy.create("invalid String merger input");const r=[];for(let n=0;n<e.length;n++)r.push(e.charAt(n)),t.length>n&&r.push(t.charAt(n));return r.join("")}class ev{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=Zy("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=Zy("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===Xy&&(Xy=new ev),Xy}}var tv;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VISIBLE=1]="VISIBLE",e[e.HIDDEN=2]="HIDDEN"}(tv||(tv={}));const nv=["firebase_","google_","ga_"],rv=new RegExp("^[a-zA-Z]\\w*$");function iv(){const e=Jy.getInstance().navigator;return(null==e?void 0:e.serviceWorker)?e.serviceWorker.controller?2:3:1}function sv(){switch(Jy.getInstance().document.visibilityState){case"visible":return tv.VISIBLE;case"hidden":return tv.HIDDEN;default:return tv.UNKNOWN}}function ov(){const e=Jy.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function av(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.appId;if(!n)throw Hy.create("no app id");return n}const cv="0.0.1",uv={loggingEnabled:!0},lv="FIREBASE_INSTALLATIONS_AUTH";const hv="Could not fetch config, will use default configs";function dv(e){if(!e)return e;const t=ev.getInstance(),n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=uv.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):uv.logSource&&(t.logSource=uv.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:uv.logEndPointUrl&&(t.logEndPointUrl=uv.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:uv.transportKey&&(t.transportKey=uv.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==uv.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=uv.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==uv.tracesSamplingRate&&(t.tracesSamplingRate=uv.tracesSamplingRate),t.logTraceAfterSampling=fv(t.tracesSamplingRate),t.logNetworkAfterSampling=fv(t.networkRequestsSamplingRate),e}function fv(e){return Math.random()<=e}let pv,gv=1;function mv(e){return gv=2,pv=pv||function(e){return function(){const e=Jy.getInstance().document;return new Promise((t=>{if(e&&"complete"!==e.readyState){const n=()=>{"complete"===e.readyState&&(e.removeEventListener("readystatechange",n),t())};e.addEventListener("readystatechange",n)}else t()}))}().then((()=>function(e){const t=e.getId();return t.then((e=>{Qy=e})),t}(e.installations))).then((t=>function(e,t){const n=function(){const e=Jy.getInstance().localStorage;if(!e)return;const t=e.getItem($y);if(!(t&&(n=t,Number(n)>Date.now())))return;var n;const r=e.getItem(qy);if(r)try{return JSON.parse(r)}catch(e){return}}();return n?(dv(n),Promise.resolve()):function(e,t){return function(e){const t=e.getToken();return t.then((e=>{})),t}(e.installations).then((n=>{const r=function(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!n)throw Hy.create("no project id");return n}(e.app),i=function(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!n)throw Hy.create("no api key");return n}(e.app),s=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${r}/namespaces/fireperf:fetch?key=${i}`,{method:"POST",headers:{Authorization:`${lv} ${n}`},body:JSON.stringify({app_instance_id:t,app_instance_id_token:n,app_id:av(e.app),app_version:Uy,sdk_version:cv})});return fetch(s).then((e=>{if(e.ok)return e.json();throw Hy.create("RC response not ok")}))})).catch((()=>{zy.info(hv)}))}(e,t).then(dv).then((e=>function(e){const t=Jy.getInstance().localStorage;e&&t&&(t.setItem(qy,JSON.stringify(e)),t.setItem($y,String(Date.now()+60*ev.getInstance().configTimeToLive*60*1e3)))}(e)),(()=>{}))}(e,t))).then((()=>yv()),(()=>yv()))}(e),pv}function yv(){gv=3}const vv=1e4,wv=3,_v=1e3;let bv,Tv=wv,Ev=[],Iv=!1;function kv(e){setTimeout((()=>{if(0!==Tv)return Ev.length?void function(){const e=Ev.splice(0,_v),t=e.map((e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})));(function(e,t){return function(e){const t=ev.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then((e=>(e.ok||zy.info("Call to Firebase backend failed."),e.json()))).then((e=>{const n=Number(e.nextRequestWaitMillis);let r=vv;isNaN(n)||(r=Math.max(n,r));const i=e.logResponseDetails;Array.isArray(i)&&i.length>0&&"RETRY_REQUEST_LATER"===i[0].responseAction&&(Ev=[...t,...Ev],zy.info("Retry transport request later.")),Tv=wv,kv(r)}))})({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:ev.getInstance().logSource,log_event:t},e).catch((()=>{Ev=[...e,...Ev],Tv--,zy.info(`Tries left: ${Tv}.`),kv(vv)}))}():kv(vv)}),e)}function Sv(e,t){bv||(bv=function(e){return(...t)=>{!function(e){if(!e.eventTime||!e.message)throw Hy.create("invalid cc log");Ev=[...Ev,e]}({message:e(...t),eventTime:Date.now()})}}(Rv)),bv(e,t)}function Cv(e){const t=ev.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&Jy.getInstance().requiredApisAvailable()&&(e.isAuto&&sv()!==tv.VISIBLE||(3===gv?Av(e):mv(e.performanceController).then((()=>Av(e)),(()=>Av(e)))))}function Av(e){if(!Yy())return;const t=ev.getInstance();t.loggingEnabled&&t.logTraceAfterSampling&&setTimeout((()=>Sv(e,1)),0)}function Rv(e,t){return 0===t?function(e){const t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:Nv(e.performanceController.app),network_request_metric:t};return JSON.stringify(n)}(e):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);const n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);const r={application_info:Nv(e.performanceController.app),trace_metric:t};return JSON.stringify(r)}(e)}function Nv(e){return{google_app_id:av(e),app_instance_id:Yy(),web_app_info:{sdk_version:Uy,page_url:Jy.getInstance().getUrl(),service_worker_status:iv(),visibility_state:sv(),effective_connection_type:ov()},application_process_state:0}}const Dv=["_fp",By,jy];class Ov{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=Jy.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${Fy}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw Hy.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw Hy.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Cv(this)}record(e,t,n){if(e<=0)throw Hy.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Hy.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const e of Object.keys(n.metrics))isNaN(Number(n.metrics[e]))||(this.counters[e]=Math.floor(Number(n.metrics[e])));Cv(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,r=this.name,0===n.length||n.length>100||!(r&&r.startsWith(Vy)&&Dv.indexOf(n)>-1)&&n.startsWith("_"))throw Hy.create("invalid custom metric name",{customMetricName:e});var n,r;this.counters[e]=function(e){const t=Math.floor(e);return t<e&&zy.info(`Metric value should be an Integer, setting the value as : ${t}.`),t}(null!=t?t:0)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const n=!(0===(r=e).length||r.length>40||nv.some((e=>r.startsWith(e)))||!r.match(rv));var r;const i=function(e){return 0!==e.length&&e.length<=100}(t);if(n&&i)this.customAttributes[e]=t;else{if(!n)throw Hy.create("invalid attribute name",{attributeName:e});if(!i)throw Hy.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor(1e3*(t.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){const i=Jy.getInstance().getUrl();if(!i)return;const s=new Ov(e,Vy+i,!0),o=Math.floor(1e3*Jy.getInstance().getTimeOrigin());if(s.setStartTime(o),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),n){const e=n.find((e=>"first-paint"===e.name));e&&e.startTime&&s.putMetric("_fp",Math.floor(1e3*e.startTime));const t=n.find((e=>"first-contentful-paint"===e.name));t&&t.startTime&&s.putMetric(By,Math.floor(1e3*t.startTime)),r&&s.putMetric(jy,Math.floor(1e3*r))}Cv(s)}static createUserTimingTrace(e,t){Cv(new Ov(e,t,!1,t))}}function Pv(e,t){const n=t;if(!n||void 0===n.responseStart)return;const r=Jy.getInstance().getTimeOrigin(),i=Math.floor(1e3*(n.startTime+r)),s=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,o=Math.floor(1e3*(n.responseEnd-n.startTime));!function(e){const t=ev.getInstance();if(!t.instrumentationEnabled)return;const n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0];n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout((()=>Sv(e,0)),0)}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:i,timeToResponseInitiatedUs:s,timeToResponseCompletedUs:o})}const Lv=5e3;function Mv(e){Yy()&&(setTimeout((()=>function(e){const t=Jy.getInstance(),n=t.getEntriesByType("navigation"),r=t.getEntriesByType("paint");if(t.onFirstInputDelay){let i=setTimeout((()=>{Ov.createOobTrace(e,n,r),i=void 0}),Lv);t.onFirstInputDelay((t=>{i&&(clearTimeout(i),Ov.createOobTrace(e,n,r,t))}))}else Ov.createOobTrace(e,n,r)}(e)),0),setTimeout((()=>function(e){const t=Jy.getInstance(),n=t.getEntriesByType("resource");for(const t of n)Pv(e,t);t.setupObserver("resource",(t=>Pv(e,t)))}(e)),0),setTimeout((()=>function(e){const t=Jy.getInstance(),n=t.getEntriesByType("measure");for(const t of n)xv(e,t);t.setupObserver("measure",(t=>xv(e,t)))}(e)),0))}function xv(e,t){const n=t.name;n.substring(0,Fy.length)!==Fy&&Ov.createUserTimingTrace(e,n)}class Uv{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),Jy.getInstance().requiredApisAvailable()?g().then((e=>{e&&(Iv||(kv(5500),Iv=!0),mv(this).then((()=>Mv(this)),(()=>Mv(this))),this.initialized=!0)})).catch((e=>{zy.info(`Environment doesn't support IndexedDB: ${e}`)})):zy.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){ev.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return ev.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){ev.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return ev.getInstance().dataCollectionEnabled}}we(new P("performance",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw Hy.create("FB not default");if("undefined"==typeof window)throw Hy.create("no window");!function(e){Wy=e}(window);const i=new Uv(n,r);return i._init(t),i}),"PUBLIC")),Se(My,xy),Se(My,xy,"esm2017");const Fv=new Map,Vv={activated:!1,tokenObservers:[]},Bv={initialized:!1,enabled:!1};function jv(e){return Fv.get(e)||Object.assign({},Vv)}function qv(){return Bv}const $v="https://content-firebaseappcheck.googleapis.com/v1",Kv="exchangeDebugToken",Hv={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4},zv=864e5;class Gv{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch((()=>{}))}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new h,await function(e){return new Promise((t=>{setTimeout(t,e)}))}(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new h,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch((()=>{}))}catch(e){this.retryPolicy(e)?this.process(!1).catch((()=>{})):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}const Wv=new v("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Qv(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function Xv(e){if(!jv(e).activated)throw Wv.create("use-before-activation",{appName:e.name})}function Jv(e){const t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-3600*n*24)/3600),i=Math.floor((t-3600*n*24-3600*r)/60),s=t-3600*n*24-3600*r-60*i;let o="";return n&&(o+=Yv(n)+"d:"),r&&(o+=Yv(r)+"h:"),o+=Yv(i)+"m:"+Yv(s)+"s",o}function Yv(e){return 0===e?"00":e>=10?e.toString():"0"+e}async function Zv({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});if(i){const e=await i.getHeartbeatsHeader();e&&(r["X-Firebase-Client"]=e)}const s={method:"POST",body:JSON.stringify(t),headers:r};let o,a;try{o=await fetch(e,s)}catch(e){throw Wv.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==o.status)throw Wv.create("fetch-status-error",{httpStatus:o.status});try{a=await o.json()}catch(e){throw Wv.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw Wv.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const u=1e3*Number(c[1]),l=Date.now();return{token:a.token,expireTimeMillis:l+u,issuedAtTimeMillis:l}}const ew="firebase-app-check-database",tw=1,nw="firebase-app-check-store",rw="debug-token";let iw=null;function sw(){return iw||(iw=new Promise(((e,t)=>{try{const n=indexedDB.open(ew,tw);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(Wv.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(nw,{keyPath:"compositeKey"})}}catch(e){t(Wv.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})),iw)}async function ow(e,t){const n=(await sw()).transaction(nw,"readwrite"),r=n.objectStore(nw).put({compositeKey:e,value:t});return new Promise(((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(Wv.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}}))}async function aw(e){const t=(await sw()).transaction(nw,"readonly"),n=t.objectStore(nw).get(e);return new Promise(((e,r)=>{n.onsuccess=t=>{const n=t.target.result;e(n?n.value:void 0)},t.onerror=e=>{var t;r(Wv.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}}))}function cw(e){return`${e.options.appId}-${e.name}`}const uw=new K("@firebase/app-check");function lw(e,t){return p()?function(e,t){return ow(cw(e),t)}(e,t).catch((e=>{uw.warn(`Failed to write token to IndexedDB. Error: ${e}`)})):Promise.resolve()}function hw(){return qv().enabled}async function dw(){const e=qv();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}const fw={error:"UNKNOWN_ERROR"};async function pw(e,t=!1){const n=e.app;Xv(n);const r=jv(n);let i,s=r.token;if(s&&!ww(s)&&(r.token=void 0,s=void 0),!s){const e=await r.cachedTokenPromise;e&&(ww(e)?s=e:await lw(n,void 0))}if(!t&&s&&ww(s))return{token:s.token};let o,a=!1;if(hw()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Zv(function(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${$v}/projects/${n}/apps/${r}:${Kv}?key=${i}`,body:{debug_token:t}}}(n,await dw()),e.heartbeatServiceProvider).finally((()=>{r.exchangeTokenPromise=void 0})),a=!0);const t=await r.exchangeTokenPromise;return await lw(n,t),r.token=t,{token:t.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally((()=>{r.exchangeTokenPromise=void 0})),a=!0),s=await jv(n).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?uw.warn(e.message):uw.error(e),i=e}return s?i?o=ww(s)?{token:s.token,internalError:i}:_w(i):(o={token:s.token},r.token=s,await lw(n,s)):o=_w(i),a&&vw(n,o),o}function gw(e,t,n,r){const{app:i}=e,s=jv(i),o={next:n,error:r,type:t};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&ww(s.token)){const t=s.token;Promise.resolve().then((()=>{n({token:t.token}),yw(e)})).catch((()=>{}))}s.cachedTokenPromise.then((()=>yw(e)))}function mw(e,t){const n=jv(e),r=n.tokenObservers.filter((e=>e.next!==t));0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=r}function yw(e){const{app:t}=e,n=jv(t);let r=n.tokenRefresher;r||(r=function(e){const{app:t}=e;return new Gv((async()=>{let n;if(n=jv(t).token?await pw(e,!0):await pw(e),n.error)throw n.error;if(n.internalError)throw n.internalError}),(()=>!0),(()=>{const e=jv(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;const n=e.token.expireTimeMillis-3e5;return t=Math.min(t,n),Math.max(0,t-Date.now())}return 0}),Hv.RETRIAL_MIN_WAIT,Hv.RETRIAL_MAX_WAIT)}(e),n.tokenRefresher=r),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function vw(e,t){const n=jv(e).tokenObservers;for(const e of n)try{"EXTERNAL"===e.type&&null!=t.error?e.error(t.error):e.next(t)}catch(e){}}function ww(e){return e.expireTimeMillis-Date.now()>0}function _w(e){return{token:(t=fw,n.encodeString(JSON.stringify(t),!1)),error:e};var t}class bw{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=jv(this.app);for(const t of e)mw(this.app,t.next);return Promise.resolve()}}const Tw="https://www.google.com/recaptcha/enterprise.js";function Ew(e,t){const n=new h;jv(e).reCAPTCHAState={initialized:n};const r=function(e){const t=`fire_app_check_${e.name}`,n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}(e),i=Qv(!0);return i?Iw(e,t,i,r,n):function(i){const s=document.createElement("script");s.src=Tw,s.onload=()=>{const i=Qv(!0);if(!i)throw new Error("no recaptcha");Iw(e,t,i,r,n)},document.head.appendChild(s)}(),n.promise}function Iw(e,t,n,r,i){n.ready((()=>{!function(e,t,n,r){const i=n.render(r,{sitekey:t,size:"invisible"}),s=jv(e);s.reCAPTCHAState=Object.assign(Object.assign({},s.reCAPTCHAState),{widgetId:i})}(e,t,n,r),i.resolve(n)}))}class kw{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t;!function(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw Wv.create("throttled",{time:Jv(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}(this._throttleData);const n=await async function(e){Xv(e);const t=jv(e).reCAPTCHAState,n=await t.initialized.promise;return new Promise(((t,r)=>{const i=jv(e).reCAPTCHAState;n.ready((()=>{t(n.execute(i.widgetId,{action:"fire_app_check"}))}))}))}(this._app).catch((e=>{throw Wv.create("recaptcha-error")}));let r;try{r=await Zv(function(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${$v}/projects/${n}/apps/${r}:exchangeRecaptchaEnterpriseToken?key=${i}`,body:{recaptcha_enterprise_token:t}}}(this._app,n),this._heartbeatServiceProvider)}catch(n){throw(null===(e=n.code)||void 0===e?void 0:e.includes("fetch-status-error"))?(this._throttleData=function(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+zv,httpStatus:e};{const n=t?t.backoffCount:0,r=function(e,t=A,n=R){const r=t*Math.pow(n,e),i=Math.round(D*r*(Math.random()-.5)*2);return Math.min(N,r+i)}(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}}(Number(null===(t=n.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),Wv.create("throttled",{time:Jv(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):n}return this._throttleData=null,r}initialize(e){this._app=e,this._heartbeatServiceProvider=_e(e,"heartbeat"),Ew(e,this._siteKey).catch((()=>{}))}isEqual(e){return e instanceof kw&&this._siteKey===e._siteKey}}const Sw="app-check-internal";we(new P("app-check",(e=>{return t=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),new bw(t,n);var t,n}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider(Sw).initialize()}))),we(new P(Sw,(e=>{return t=e.getProvider("app-check").getImmediate(),{getToken:e=>pw(t,e),addTokenListener:e=>gw(t,"INTERNAL",e),removeTokenListener:e=>mw(t.app,e)};var t}),"PUBLIC").setInstantiationMode("EXPLICIT")),Se("@firebase/app-check","0.6.3");const Cw={apiKey:"AIzaSyCsPiMQWrMWQKB0PrQDfHbxokTcR4TRxGc",authDomain:"qs-nohe-fb-func.firebaseapp.com",projectId:"qs-nohe-fb-func",storageBucket:"qs-nohe-fb-func.appspot.com",messagingSenderId:"668582889497",appId:"1:668582889497:web:daa041767d60d39b964288"},Aw={key:""};function Rw(){return Sr().currentUser.photoURL||"/images/profile_placeholder.png"}function Nw(){return Sr().currentUser.displayName}async function Dw(e){try{const o=await zp($f(Zf(),"messages"),{name:Nw(),imageUrl:Mw,profilePicUrl:Rw(),timestamp:Wp()}),a=`${Sr().currentUser.uid}/${o.id}/${e.name}`,u=(i=function(e=ke(),t){const n=_e(e=O(e),am).getImmediate({identifier:t}),r=c("storage");return r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"==typeof i?i:d(i,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}(),s=a,function(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof im)return new em(e,t);throw sg("To use ref(service, url), the first argument must be a Storage instance.")}return nm(e,t)}(i=O(i),s)),l=await(t=u,n=e,function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new Zg(e,new Cg(t),n)}(t=O(t),n,r)),h=await function(e){return tm(e=O(e))}(u);await function(e,t,n,...r){e=xf(e,Bf);const i=xf(e.firestore,Yf),s=dp(i);let o;return o="string"==typeof(t=O(t))||t instanceof rp?function(e,t,n,r,i,s){const o=e.da(1,t,n),a=[_p(t,r,n)],c=[i];if(s.length%2!=0)throw new $a(qa.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(_p(t,s[e])),c.push(s[e+1]);const u=[],l=Eu.empty();for(let e=a.length-1;e>=0;--e)if(!Ip(u,a[e])){const t=a[e];let n=c[e];n=O(n);const r=o.ca(t);if(n instanceof pp)u.push(t);else{const e=mp(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new Tu(u);return new cp(l,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.da(1,t,n);wp("Data must be an object, but it was:",i,r);const s=[],o=Eu.empty();Tc(r,((e,r)=>{const a=Tp(t,e,n);r=O(r);const c=i.ca(a);if(r instanceof pp)s.push(a);else{const e=mp(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new Tu(s);return new cp(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),Gp(i,[o.toMutation(e._key,ll.exists(!0))])}(o,{imageUrl:h,storageUri:l.metadata.fullPath})}catch(e){console.error("There was an error uploading a file to Cloud Storage:",e)}var t,n,r,i,s}async function Ow(){try{const e=await async function(e,t){return Ny(e=O(e),void 0)}(Ly());if(e){console.log("Got FCM device token:",e);const t=Kf(Zf(),"fcmTokens",e);await function(e,t,n){e=xf(e,Bf);const r=xf(e.firestore,Yf),i=Vp(e.converter,t,n);return Gp(r,[fp(dp(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,ll.none())])}(t,{uid:Sr().currentUser.uid}),function(e,t){(function(e,t){if(!navigator)throw vy.create("only-available-in-window");e.onMessageHandler=t})(e=O(e),t)}(Ly(),(e=>{console.log("New foreground notification from Firebase Messaging!",e.notification)}))}else!async function(){console.log("Requesting notifications permission..."),"granted"===await Notification.requestPermission()?(console.log("Notification permission granted."),await Ow()):console.log("Unable to get permission to notify.")}()}catch(e){console.error("Unable to get messaging token.",e)}}function Pw(){return!!Sr().currentUser||(Ww.MaterialSnackbar.showSnackbar({message:"You must sign-in first",timeout:2e3}),!1)}console.log("production");function Lw(e){return-1!==e.indexOf("googleusercontent.com")&&-1===e.indexOf("?")?e+"?sz=150":e}var Mw="https://www.google.com/images/spin-32.gif?a";function xw(){Vw.value?Bw.removeAttribute("disabled"):Bw.setAttribute("disabled","true")}var Uw=document.getElementById("messages"),Fw=document.getElementById("message-form"),Vw=document.getElementById("message"),Bw=document.getElementById("submit"),jw=document.getElementById("submitImage"),qw=document.getElementById("image-form"),$w=document.getElementById("mediaCapture"),Kw=document.getElementById("user-pic"),Hw=document.getElementById("user-name"),zw=document.getElementById("sign-in"),Gw=document.getElementById("sign-out"),Ww=document.getElementById("must-signin-snackbar");Fw.addEventListener("submit",(function(e){e.preventDefault(),Vw.value&&Pw()&&async function(e){try{await zp($f(Zf(),"messages"),{name:Nw(),text:e,profilePicUrl:Rw(),timestamp:Wp()})}catch(e){console.error("Error writing new message to Firebase Database",e)}}(Vw.value).then((function(){var e;(e=Vw).value="",e.parentNode.MaterialTextfield.boundUpdateClassesHandler(),xw()}))})),Gw.addEventListener("click",(function(){O(Sr()).signOut()})),zw.addEventListener("click",(async function(){var e=new tn;await async function(e,t,n){const r=Bt(e);!function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&$e(e,"argument-error"),He(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t,Yt);const i=Ln(r,void 0);return new jn(r,"signInViaPopup",t,i).executeNotNull()}(Sr(),e)})),Vw.addEventListener("keyup",xw),Vw.addEventListener("change",xw),jw.addEventListener("click",(function(e){e.preventDefault(),$w.click()})),$w.addEventListener("change",(function(e){e.preventDefault();var t=e.target.files[0];qw.reset(),t.type.match("image.*")?Pw()&&Dw(t):Ww.MaterialSnackbar.showSnackbar({message:"You can only share images",timeout:2e3})}));var Qw;(function(e=ke(),t){const n=_e(e=O(e),"app-check");if(qv().initialized||function(){const e=s(),t=qv();if(t.initialized=!0,"string"!=typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN&&!0!==e.FIREBASE_APPCHECK_DEBUG_TOKEN)return;t.enabled=!0;const n=new h;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(async function(){let e;try{e=await aw(rw)}catch(e){}if(e)return e;{const e=C();return(t=e,ow(rw,t)).catch((e=>uw.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`))),e}var t}())}(),hw()&&dw().then((e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`))),n.isInitialized()){const r=n.getImmediate(),i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw Wv.create("already-initialized",{appName:e.name})}const r=n.initialize({options:t});(function(e,t,n){const r=function(e,t){return Fv.set(e,t),Fv.get(e)}(e,Object.assign({},Vv));r.activated=!0,r.provider=t,r.cachedTokenPromise=async function(e){if(p()){let t;try{t=await function(e){return aw(cw(e))}(e)}catch(e){uw.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return t}}(e).then((t=>(t&&ww(t)&&(r.token=t,vw(e,{token:t.token})),t))),r.isTokenAutoRefreshEnabled=void 0===n?e.automaticDataCollectionEnabled:n,r.provider.initialize(e)})(e,t.provider,t.isTokenAutoRefreshEnabled),jv(e).isTokenAutoRefreshEnabled&&gw(r,"INTERNAL",(()=>{}))})(Ie(function(){if(Cw&&Cw.apiKey)return Cw;throw new Error("No Firebase configuration object provided.\nAdd your web app's configuration object to firebase-config.js")}()),{provider:new kw(function(){if(Aw&&Aw.key)return Aw.key;throw new Error("No enterprise reCaptcha key found.\nAdd pme om the web app's config in firebase-config.js")}()),isTokenAutoRefreshEnabled:!0}),function(e=ke()){_e(e=O(e),"performance").getImmediate()}(),Qw=function(e){if(e){var t=Rw(),n=Nw();Kw.style.backgroundImage="url("+Lw(t)+")",Hw.textContent=n,Hw.removeAttribute("hidden"),Kw.removeAttribute("hidden"),Gw.removeAttribute("hidden"),zw.setAttribute("hidden","true"),Ow()}else Hw.setAttribute("hidden","true"),Kw.setAttribute("hidden","true"),Gw.setAttribute("hidden","true"),zw.removeAttribute("hidden")},O(Sr()).onAuthStateChanged(Qw,undefined,undefined),function(){const e=function(e,t,...n){let r=[];t instanceof Ap&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof Dp)).length,n=e.filter((e=>e instanceof Np)).length;if(t>1||t>0&&n>0)throw new $a(qa.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}($f(Zf(),"messages"),function(e,t="asc"){const n=t,r=Cp("orderBy","timestamp");return Op._create(r,n)}(0,"desc"),(function(e,t){if(t<=0)throw new $a(qa.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",12),Pp._create("limit",12,"F")));!function(e,...t){var n,r,i;e=O(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||Jf(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Jf(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,l;if(e instanceof Bf)u=xf(e.firestore,Yf),l=Ou(e._key.path),c={next:n=>{t[o]&&t[o](function(e,t,n){const r=n.docs.get(t._key),i=new Hp(e);return new jp(e,i,t._key,r,new Bp(n.hasPendingWrites,n.fromCache),t.converter)}(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=xf(e,jf);u=xf(n.firestore,Yf),l=n._query;const r=new Hp(u);c={next:e=>{t[o]&&t[o](new $p(u,r,n,e))},error:t[o+1],complete:t[o+2]},function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new $a(qa.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query)}!function(e,t,n,r){const i=new Hf(r),s=new sf(t,i,n);e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=ja(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Zd),i)try{s.Au=await n.onListen(r)}catch(e){const n=Qd(e,`Initialization of query '${$u(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.bu(n.onlineState),s.Au&&t.Pu(s.Au)&&rf(n)}(await Qf(e),s)))}(ep(u),l,a,c)}(e,(function(e){e.docChanges().forEach((function(e){if("removed"===e.type)!function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}(e.doc.id);else{var t=e.doc.data();!function(e,t,n,r,i,s){var o=document.getElementById(e)||function(e,t){const n=document.createElement("div");n.innerHTML='<div class="message-container"><div class="spacing"><div class="pic"></div></div><div class="message"></div><div class="name"></div></div>';const r=n.firstChild;r.setAttribute("id",e),t=t?t.toMillis():Date.now(),r.setAttribute("timestamp",t);const i=Uw.children;if(0===i.length)Uw.appendChild(r);else{let e=i[0];for(;e;){const n=e.getAttribute("timestamp");if(!n)throw new Error(`Child ${e.id} has no 'timestamp' attribute`);if(n>t)break;e=e.nextSibling}Uw.insertBefore(r,e)}return r}(e,t);i&&(o.querySelector(".pic").style.backgroundImage="url("+Lw(i)+")"),o.querySelector(".name").textContent=n;var a=o.querySelector(".message");if(r)a.textContent=r,a.innerHTML=a.innerHTML.replace(/\n/g,"<br>");else if(s){var c=document.createElement("img");c.addEventListener("load",(function(){Uw.scrollTop=Uw.scrollHeight})),c.src=s+"&"+(new Date).getTime(),a.innerHTML="",a.appendChild(c)}setTimeout((function(){o.classList.add("visible")}),1),Uw.scrollTop=Uw.scrollHeight,Vw.focus()}(e.doc.id,t.timestamp,t.name,t.text,t.profilePicUrl,t.imageUrl)}}))}))}()})();